<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic Meta Tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>P.O.P.S. Media Hub v0.4.0</title>

  <!-- SEO Meta Tags -->
  <title>P.O.P.S. Media Hub - Interactive Audio, Video & Media Platform</title>
  <meta name="description" content="P.O.P.S. Media Hub is your ultimate interactive media platform featuring Roger AI assistant, playlist generation, audio/video streaming, and dynamic content management. Experience next-gen media control.">
  <meta name="keywords" content="media hub, audio player, video streaming, playlist generator, AI assistant, Roger AI, interactive media, music player, media platform, entertainment hub, Cleveland media">
  <meta name="author" content="P.O.P.S. Media Hub">
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
  <meta name="language" content="English">
  <meta name="revisit-after" content="7 days">
  <meta name="rating" content="General">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://popsmediahub.com/">
  <meta property="og:title" content="P.O.P.S. Media Hub - Interactive Audio, Video & Media Platform">
  <meta property="og:description" content="Experience the future of media management with P.O.P.S. Media Hub. Interactive AI assistant, smart playlists, seamless streaming, and dynamic content control all in one platform.">
  <meta property="og:image" content="https://popsmediahub.com/images/pops-hub-preview.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="P.O.P.S. Media Hub">
  <meta property="og:locale" content="en_US">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://popsmediahub.com/">
  <meta name="twitter:title" content="P.O.P.S. Media Hub - Interactive Media Platform">
  <meta name="twitter:description" content="Your ultimate interactive media platform with AI assistant Roger, smart playlists, and seamless audio/video streaming. Experience next-gen media control.">
  <meta name="twitter:image" content="https://popsmediahub.com/images/pops-hub-twitter.jpg">
  <meta name="twitter:image:alt" content="P.O.P.S. Media Hub interface showing Roger AI assistant and media controls">
  <meta name="twitter:creator" content="@POPSMediaHub">
  <meta name="twitter:site" content="@POPSMediaHub">
  
  <!-- Geo Location Tags -->
  <meta name="geo.region" content="US-OH">
  <meta name="geo.placename" content="Cleveland">
  <meta name="geo.position" content="41.4993;-81.6944">
  <meta name="ICBM" content="41.4993, -81.6944">
  <meta name="DC.title" content="P.O.P.S. Media Hub">
  
  <!-- Additional Location Tags -->
  <meta name="locality" content="Cleveland">
  <meta name="region" content="Ohio">
  <meta name="country-name" content="United States">
  <meta name="postal-code" content="44101">
  
  <!-- Structured Data for Local Business (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "P.O.P.S. Media Hub",
    "applicationCategory": "MultimediaApplication",
    "operatingSystem": "Web Browser",
    "description": "Interactive media platform featuring AI assistant Roger, playlist generation, audio/video streaming, and dynamic content management.",
    "url": "https://popsmediahub.com",
    "author": {
      "@type": "Organization",
      "name": "P.O.P.S. Media Hub",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Cleveland",
        "addressRegion": "OH",
        "addressCountry": "US"
      }
    },
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "ratingCount": "150"
    },
    "featureList": [
      "AI Assistant Integration",
      "Smart Playlist Generation",
      "Audio/Video Streaming",
      "Interactive Media Controls",
      "File Upload Support",
      "Mobile Responsive Design",
      "Real-time Media Management"
    ]
  }
  </script>
  
  <!-- Favicon and App Icons -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  
  <!-- Theme and App Meta -->
  <meta name="theme-color" content="#6be675">
  <meta name="msapplication-TileColor" content="#0a0c10">
  <meta name="msapplication-config" content="/browserconfig.xml">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="P.O.P.S. Hub">
  
  <!-- Preconnect and DNS Prefetch -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://commondatastorage.googleapis.com">
  <link rel="dns-prefetch" href="https://picsum.photos">
  
  <!-- Stylesheets -->
<style>
/* CSS Variables for theming */
:root {
  --bg: #0a0c10;
  --fg: #e6e8ee;
  --accent: #6be675;
  --panel: #1a1f2b;
  --card: #121621;
  --rim: #20253a;
  --hot: #ff4d6d;
  --warning: #ffa500;
  --shadow: rgba(0, 0, 0, 0.3);
  --transition: all 0.3s ease;
}

/* Reset and base styles */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'JetBrains Mono', monospace;
  background: var(--bg);
  color: var(--fg);
  display: flex;
  min-height: 100vh;
  overflow-x: hidden;
  line-height: 1.6;
}

body.menu-open {
  overflow: hidden;
}

h1, h2, h3 {
  margin: 0.5rem 0;
  font-weight: 600;
}

h1 {
  font-size: clamp(1.5rem, 4vw, 2.5rem);
  margin-bottom: 1rem;
}

/* Mobile menu toggle button */
.mobile-menu-toggle {
  position: fixed;
  top: 1rem;
  left: 1rem;
  z-index: 1001;
  background: var(--accent);
  color: #000;
  border: none;
  border-radius: 8px;
  padding: 0.75rem;
  font-size: 1.2rem;
  cursor: pointer;
  box-shadow: 0 2px 10px var(--shadow);
  transition: var(--transition);
  display: none;
}

.mobile-menu-toggle:hover {
  transform: scale(1.05);
  background: var(--hot);
}

/* App container */
#app {
  display: flex;
  width: 100%;
  min-height: 100vh;
  position: relative;
}

/* Sidebar styles */
.sidebar {
  width: 280px;
  background: var(--panel);
  padding: 1.5rem;
  height: 100vh;
  box-shadow: 2px 0 20px var(--shadow);
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  position: fixed;
  left: 0;
  top: 0;
  z-index: 1000;
  overflow-y: auto;
}

.sidebar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid var(--rim);
  padding-bottom: 1rem;
}

.sidebar-close {
  display: none;
  background: none;
  border: none;
  color: var(--hot);
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  transition: var(--transition);
}

.sidebar-close:hover {
  background: var(--card);
  color: var(--accent);
}

.title {
  font-weight: 600;
  font-size: 1.2rem;
  color: var(--accent);
}

.command-buttons {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.sidebar-section {
  margin-top: auto;
  padding-top: 1rem;
  border-top: 1px solid var(--rim);
}

.drip-counter {
  font-size: 0.95rem;
  margin-bottom: 1rem;
  color: var(--hot);
  font-weight: 500;
  text-align: center;
  background: var(--card);
  padding: 0.75rem;
  border-radius: 8px;
}

.leaderboard-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.leaderboard-item {
  background: var(--card);
  padding: 0.75rem;
  border-radius: 8px;
  font-size: 0.85rem;
  border-left: 3px solid var(--accent);
  transition: var(--transition);
}

.leaderboard-item:hover {
  background: var(--rim);
  transform: translateX(2px);
}

/* Missing files notification */
.missing-files-notification {
  background: var(--hot);
  color: white;
  padding: 1rem;
  margin: 1rem 0;
  border-radius: 8px;
  text-align: center;
  animation: fadeIn 0.5s ease;
}

.missing-files-notification p {
  margin: 0 0 1rem 0;
}

.missing-files-notification button {
  margin: 0 0.25rem;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Sidebar overlay for mobile */
.sidebar-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.5);
  z-index: 999;
  opacity: 0;
  visibility: hidden;
  transition: var(--transition);
}

.sidebar-overlay.show {
  opacity: 1;
  visibility: visible;
}

/* Main content */
#main {
  margin-left: 280px;
  flex: 1;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.main-content {
  padding: 2rem;
  flex: 1;
  overflow-y: auto;
}

#rogerOutput {
  padding: 1.5rem;
  font-size: 1rem;
  background: var(--card);
  border-left: 4px solid var(--accent);
  margin-bottom: 2rem;
  border-radius: 8px;
  box-shadow: 0 2px 10px var(--shadow);
}

#mediaOutput {
  margin-top: 2rem;
}

#mediaOutput img, 
#mediaOutput video {
  max-width: 100%;
  height: auto;
  border-radius: 12px;
  box-shadow: 0 8px 25px var(--shadow);
  transition: opacity 0.5s ease, transform 0.3s ease;
  opacity: 0;
}

#mediaOutput img.loaded, 
#mediaOutput video.loaded {
  opacity: 1;
  transform: scale(1);
}

#mediaOutput img:hover, 
#mediaOutput video:hover {
  transform: scale(1.02);
}

/* Button styles */
button {
  background: var(--accent);
  color: #000;
  padding: 0.75rem 1.25rem;
  font-size: 0.9rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-family: inherit;
  font-weight: 500;
  transition: var(--transition);
  box-shadow: 0 2px 8px rgba(107, 230, 117, 0.2);
}

button:hover {
  background: var(--hot);
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(255, 77, 109, 0.3);
}

button:active {
  transform: translateY(0);
}

button:disabled {
  background: var(--rim);
  color: var(--fg);
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* Audio Player Overlay */
#audioOverlay {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--panel);
  padding: 1rem;
  display: none;
  z-index: 500;
  box-shadow: 0 -4px 20px var(--shadow);
  border-top: 1px solid var(--rim);
}

.audio-player-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.audio-player-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 600;
  color: var(--accent);
  font-size: 1.1rem;
}

.audio-close-btn {
  background: none;
  border: none;
  color: var(--hot);
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0.25rem;
  border-radius: 50%;
  width: 35px;
  height: 35px;
  transition: var(--transition);
}

.audio-close-btn:hover {
  background: var(--card);
  color: var(--accent);
}

.audio-info {
  margin-bottom: 1rem;
  text-align: center;
}

#audioTrackTitle {
  font-weight: 600;
  font-size: 1rem;
  margin-bottom: 0.5rem;
  color: var(--fg);
}

#audioTime {
  font-size: 0.85rem;
  color: var(--accent);
  margin-bottom: 1rem;
}

#audioProgressBarContainer {
  background: var(--rim);
  height: 8px;
  border-radius: 4px;
  cursor: pointer;
  margin-bottom: 1rem;
  position: relative;
}

#audioProgressBar {
  height: 8px;
  background: linear-gradient(90deg, var(--accent), var(--hot));
  width: 0%;
  border-radius: 4px;
  transition: width 0.1s ease;
}

.audio-controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
}

.audio-btn {
  background: var(--card);
  border: 1px solid var(--rim);
  border-radius: 8px;
  padding: 0.75rem;
  color: var(--fg);
  cursor: pointer;
  font-size: 1.2rem;
  transition: var(--transition);
  min-width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.audio-btn:hover {
  background: var(--accent);
  color: #000;
  transform: scale(1.1);
}

.audio-btn.play-pause {
  background: var(--accent);
  color: #000;
  font-size: 1.5rem;
  min-width: 60px;
  height: 60px;
}

.audio-btn.play-pause:hover {
  background: var(--hot);
}

/* Playlist Modal */
#playlistModalBackdrop {
  position: fixed;
  top: 0;
  left: 0;
  background: rgba(0, 0, 0, 0.8);
  width: 100vw;
  height: 100vh;
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1500;
  backdrop-filter: blur(4px);
}

#playlistModal {
  background: var(--panel);
  padding: 2rem;
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 10px 40px var(--shadow);
  border: 1px solid var(--rim);
}

.playlist-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--rim);
}

.playlist-title {
  font-weight: 600;
  font-size: 1.3rem;
  color: var(--accent);
}

.playlist-close-btn {
  background: none;
  border: none;
  color: var(--hot);
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0.25rem;
  border-radius: 50%;
  width: 35px;
  height: 35px;
  transition: var(--transition);
}

.playlist-close-btn:hover {
  background: var(--card);
  color: var(--accent);
}

.playlist-content {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.playlist-track {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  background: var(--card);
  border-radius: 8px;
  border-left: 3px solid var(--accent);
  transition: var(--transition);
}

.playlist-track:hover {
  background: var(--rim);
  transform: translateX(4px);
}

.playlist-track.disabled {
  opacity: 0.6;
  border-left-color: var(--warning);
}

.playlist-track button {
  padding: 0.5rem 1rem;
  font-size: 0.8rem;
}

.playlist-track button.warning {
  background: var(--warning);
  color: #000;
}

.playlist-track button.warning:hover {
  background: var(--hot);
}

/* Share button styles */
.roger-share {
  margin-top: 1rem;
  background: #1da1f2;
  color: white;
}

.roger-share:hover {
  background: #0d8bd9;
}

/* Responsive Design */
@media (max-width: 768px) {
  .mobile-menu-toggle {
    display: block;
  }

  .sidebar {
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    width: 85%;
    max-width: 320px;
  }

  .sidebar.show {
    transform: translateX(0);
  }

  .sidebar-close {
    display: block;
  }

  #main {
    margin-left: 0;
    width: 100%;
  }

  .main-content {
    padding: 1rem;
    padding-top: 5rem; /* Account for mobile menu button */
  }

  #audioOverlay {
    border-radius: 12px 12px 0 0;
    margin: 0 0.5rem;
    left: 0.5rem;
    right: 0.5rem;
    bottom: 0.5rem;
  }

  .audio-controls {
    gap: 0.75rem;
  }

  .audio-btn {
    min-width: 45px;
    height: 45px;
    font-size: 1rem;
  }

  .audio-btn.play-pause {
    min-width: 55px;
    height: 55px;
  }

  #playlistModal {
    width: 95%;
    margin: 1rem;
    padding: 1.5rem;
  }

  .playlist-track {
    flex-direction: column;
    gap: 0.75rem;
    text-align: center;
  }

  button {
    padding: 0.75rem;
    font-size: 0.85rem;
  }
}

@media (max-width: 480px) {
  .main-content {
    padding: 0.75rem;
    padding-top: 4.5rem;
  }

  h1 {
    font-size: 1.5rem;
  }

  #rogerOutput {
    padding: 1rem;
    font-size: 0.9rem;
  }

  .audio-controls {
    gap: 0.5rem;
  }

  .audio-btn {
    min-width: 40px;
    height: 40px;
    padding: 0.5rem;
  }

  .audio-btn.play-pause {
    min-width: 50px;
    height: 50px;
  }

  .sidebar {
    width: 100%;
    max-width: none;
  }
}

/* Dark mode enhancements */
@media (prefers-color-scheme: dark) {
  :root {
    --shadow: rgba(0, 0, 0, 0.5);
  }
}

/* Smooth scrolling */
html {
  scroll-behavior: smooth;
}

/* Loading states */
.loading {
  opacity: 0.6;
  pointer-events: none;
}

/* Focus states for accessibility */
button:focus,
.audio-btn:focus {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  :root {
    --accent: #00ff00;
    --hot: #ff0000;
    --rim: #666666;
  }
}
</style>
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&display=swap">
</head>
<body>
  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">☰</button>
  
  <div id="app">
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="title">Roger Commands</div>
        <button class="sidebar-close" onclick="toggleMobileMenu()">×</button>
      </div>
      
      <div class="command-buttons">
        <button onclick="roger.say('Hey, Mack!')">Say Hey</button>
        <button onclick="roger.askGrok()">Ask Grok</button>
        <button onclick="roger.generatePlaylist()">Generate Playlist</button>
        <button onclick="roger.loadMedia('video', 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4', '🎬 Big Buck Bunny')">Play Video</button>
        <button onclick="roger.loadMedia('image', 'https://picsum.photos/800/400?random=1', '🖼️ Random Art')">Show Image</button>
        <button onclick="roger.showPlaylist()">Show Playlist</button>
        <button onclick="roger.clearPlaylist()">Clear Playlist</button>
        <button onclick="document.getElementById('filePicker').click()">Load Files</button>
      </div>
      
      <div class="sidebar-section">
        <div class="title">Drip Leaderboard</div>
        <div class="drip-counter">Your Drip: <span id="dripPoints">0</span></div>
        <div class="leaderboard-list" id="leaderboardList">
          <div class="leaderboard-item">No vibes yet. Drop some!</div>
        </div>
      </div>
    </div>
    
    <div class="sidebar-overlay" onclick="toggleMobileMenu()"></div>
    
    <div id="main">
      <div class="main-content">
        <h1>P.O.P.S. Media Hub v0.4.0</h1>
        <p id="rogerOutput">Roger online. Say a command!</p>
        <div id="mediaOutput"></div>
      </div>
      
      <!-- Audio Player Overlay -->
      <div id="audioOverlay">
        <div class="audio-player-header">
          <div class="audio-player-title">
            <span>🎵</span>
            <span>Now Playing</span>
          </div>
          <button class="audio-close-btn" onclick="roger.closeAudioPlayer()">×</button>
        </div>
        <div class="audio-info">
          <div id="audioTrackTitle">No track loaded</div>
          <div id="audioTime">00:00 / 00:00</div>
        </div>
        <div id="audioProgressBarContainer" onclick="roger.seekAudio(event)">
          <div id="audioProgressBar"></div>
        </div>
        <div class="audio-controls">
          <button class="audio-btn" onclick="roger.previousTrack()">⏮️</button>
          <button class="audio-btn play-pause" id="audioPlayPauseBtn" onclick="roger.toggleAudioPlayback()">▶️</button>
          <button class="audio-btn" onclick="roger.nextTrack()">⏭️</button>
        </div>
      </div>
      
      <!-- Playlist Modal -->
      <div id="playlistModalBackdrop">
        <div id="playlistModal">
          <div class="playlist-header">
            <div class="playlist-title">Music Playlist</div>
            <button class="playlist-close-btn" onclick="roger.hidePlaylist()">×</button>
          </div>
          <div class="playlist-content" id="playlistContent"></div>
        </div>
      </div>
    </div>
  </div>
  
  <input type="file" id="filePicker" accept="audio/*,video/*,image/*" style="display:none" multiple />
  
  <script>
    // Mobile menu toggle function
    function toggleMobileMenu() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.querySelector('.sidebar-overlay');
      const body = document.body;
      
      sidebar.classList.toggle('show');
      overlay.classList.toggle('show');
      body.classList.toggle('menu-open');
    }
    
    // Close mobile menu when clicking on a command (optional)
    document.addEventListener('DOMContentLoaded', function() {
      const commandButtons = document.querySelectorAll('.command-buttons button');
      commandButtons.forEach(button => {
        button.addEventListener('click', () => {
          if (window.innerWidth <= 768) {
            toggleMobileMenu();
          }
        });
      });
    });
  </script>
  
  <script>
class RogerMediaHub {
  constructor() {
    this.rogerOutput = document.getElementById('rogerOutput');
    this.dripPointsDisplay = document.getElementById('dripPoints');
    this.leaderboardList = document.getElementById('leaderboardList');
    this.mediaOutput = document.getElementById('mediaOutput');
    this.audioOverlay = document.getElementById('audioOverlay');
    this.audioPlayer = new Audio();
    this.audioPlayPauseBtn = document.getElementById('audioPlayPauseBtn');
    this.audioTrackTitle = document.getElementById('audioTrackTitle');
    this.audioTime = document.getElementById('audioTime');
    this.audioProgressBar = document.getElementById('audioProgressBar');
    this.playlistModalBackdrop = document.getElementById('playlistModalBackdrop');
    this.playlistContent = document.getElementById('playlistContent');
    this.filePicker = document.getElementById('filePicker');
    this.playlist = [];
    this.currentTrackIndex = -1;
    this.dripPoints = parseInt(localStorage.getItem('dripPoints') || '0');
    this.leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [{ name: '@mackcwm', points: this.dripPoints }];
    this.loadedFiles = new Map(); // Store file objects for persistence
    this.persistentPlaylist = JSON.parse(localStorage.getItem('persistentPlaylist')) || [];
    this.apiKey = null; // Replace with process.env.XAI_API_KEY once available
    this.mockGrokData = {
      playlists: [
        { title: 'Neon Vibe Mix', src: 'https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3', cover: 'https://picsum.photos/50/50?random=1' },
        { title: 'Akron Night Chime', src: 'https://www.soundjay.com/misc/sounds/bell-ringing-04.mp3', cover: 'https://picsum.photos/50/50?random=2' }
      ],
      art: [{ title: 'Neon Akron Glow', src: 'https://picsum.photos/800/400?random=1' }]
    };
    this.setupAudioEvents();
    this.setupFileEvents();
    this.updateLeaderboard();
    this.loadPersistedPlaylist();
    this.say('Welcome to P.O.P.S. Media Hub v0.4.0! Drop a vibe with #POPSvibe 🚀', 5);
  }

  setupAudioEvents() {
    this.audioPlayer.ontimeupdate = () => {
      const current = this.audioPlayer.currentTime;
      const total = this.audioPlayer.duration || 0;
      this.audioTime.textContent = `${this.formatTime(current)} / ${this.formatTime(total)}`;
      const percent = (current / total) * 100;
      this.audioProgressBar.style.width = percent + '%';
    };
    this.audioPlayer.onplay = () => this.audioPlayPauseBtn.textContent = '⏸️';
    this.audioPlayer.onpause = () => this.audioPlayPauseBtn.textContent = '▶️';
    this.audioPlayer.onended = () => this.nextTrack();
  }

  setupFileEvents() {
    this.filePicker.addEventListener('change', (e) => this.handleFileLoad(e.target.files));
  }

  say(text, dripPoints = 0) {
    this.rogerOutput.textContent = `Roger: ${text}`;
    if (dripPoints > 0) this.addDripPoints(dripPoints);
  }

  addDripPoints(amount) {
    this.dripPoints += amount;
    localStorage.setItem('dripPoints', this.dripPoints);
    this.updateLeaderboard();
  }

  updateLeaderboard() {
    this.dripPointsDisplay.textContent = this.dripPoints;
    this.leaderboard[0].points = this.dripPoints;
    localStorage.setItem('leaderboard', JSON.stringify(this.leaderboard));
    this.leaderboardList.innerHTML = this.leaderboard
      .sort((a, b) => b.points - a.points)
      .slice(0, 5)
      .map((user, index) => `<div class="leaderboard-item">${index === 0 ? '👑 ' : ''}${user.name} - ${user.points} Drip</div>`)
      .join('');
  }

  async askGrok() {
    this.say('Grok API coming soon! Dropping neon art for now.', 3);
    this.loadMedia('image', this.mockGrokData.art[0].src, '🖼️ Neon Akron Glow');
  }

  async generatePlaylist(userInput = 'MackGPT vibe: upbeat hip-hop') {
    this.say(`Cooking a ${userInput} playlist...`, 5);
    try {
      let playlistData, coverArt;
      if (this.apiKey) {
        const moodResponse = await this.callXAIMoodAPI(userInput);
        const mood = moodResponse.mood || 'energetic';
        playlistData = await this.callSpotifyAPI(mood);
        coverArt = await this.generatePlaylistCover(mood);
      } else {
        this.say('No xAI API key yet. Using mock vibes!', 2);
        playlistData = { tracks: this.mockGrokData.playlists };
        coverArt = this.mockGrokData.art[0].src;
      }
      playlistData.tracks.forEach(track => this.addToPlaylist({
        src: track.url || track.src,
        title: track.name ? `${track.name} by ${track.artist}` : track.title,
        cover: track.cover || coverArt,
        isLocal: false
      }));
      if (this.currentTrackIndex === -1 && this.playlist.some(t => !t.needsReload)) {
        const firstPlayableIndex = this.playlist.findIndex(t => !t.needsReload);
        if (firstPlayableIndex >= 0) this.playTrack(firstPlayableIndex);
      }
      this.say(`Dropped a ${userInput} playlist! Share with #POPSvibe!`, 8);
      this.addDripPoints(10);
    } catch (error) {
      this.say(`Error generating playlist: ${error.message}. Get xAI API at https://x.ai/api!`, 0);
    }
  }

  async callXAIMoodAPI(input) {
    if (!this.apiKey) throw new Error('xAI API key missing. Get one at https://x.ai/api');
    const response = await fetch('https://api.x.ai/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${this.apiKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        model: 'grok-4',
        messages: [
          { role: 'system', content: 'Analyze the mood in the user input and return a single word describing it (e.g., energetic, chill, sad).' },
          { role: 'user', content: input }
        ],
        temperature: 0.5,
        max_tokens: 10
      })
    });
    if (!response.ok) throw new Error('xAI API request failed');
    const data = await response.json();
    return { mood: data.choices[0].message.content.trim() };
  }

  async callSpotifyAPI(mood) {
    return new Promise(resolve => {
      setTimeout(() => {
        const tracks = [
          { name: 'Neon Vibe Drop', artist: 'MackTunes', url: 'https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3', cover: 'https://picsum.photos/50/50?random=2' },
          { name: 'Akron Night Pulse', artist: 'GrokBeats', url: 'https://www.soundjay.com/misc/sounds/bell-ringing-04.mp3', cover: 'https://picsum.photos/50/50?random=3' }
        ];
        resolve({ tracks });
      }, 500);
    });
  }

  async generatePlaylistCover(mood) {
    if (!this.apiKey) return 'https://picsum.photos/50/50?random=1';
    const response = await fetch('https://api.x.ai/v1/images/generations', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${this.apiKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        model: 'grok-2-image',
        prompt: `A neon-styled digital art piece reflecting a ${mood} mood, vibrant colors, Akron cityscape elements, futuristic vibe`,
        n: 1
      })
    });
    if (!response.ok) throw new Error('xAI image generation failed');
    const data = await response.json();
    return data.images[0].url;
  }

  loadMedia(type, src, title) {
    this.mediaOutput.innerHTML = `<h2>${title}</h2>`;
    const media = document.createElement(type === 'video' ? 'video' : type === 'image' ? 'img' : 'audio');
    media.src = src;
    media.controls = type !== 'image';
    media.autoplay = type !== 'image';
    media.className = type !== 'image' ? 'loaded' : 'loaded';
    media.style.maxWidth = '100%';
    media.style.marginTop = '1rem';
    media.onerror = () => this.say(`Error loading ${type}: ${title}. Try another vibe.`, 0);
    media.onplay = () => this.say(`Playing ${title}. Share with #POPSvibe!`, 5);
    this.mediaOutput.appendChild(media);
    const shareBtn = document.createElement('button');
    shareBtn.className = 'roger-share';
    shareBtn.textContent = 'Share to X';
    shareBtn.onclick = () => this.shareMedia(src, title);
    this.mediaOutput.appendChild(shareBtn);
    this.addDripPoints(3);
  }

  shareMedia(src, title) {
    const shareText = encodeURIComponent(`Check out this ${title} on P.O.P.S. Media Hub! #POPSvibe ${src}`);
    window.open(`https://x.com/intent/tweet?text=${shareText}`, '_blank');
    this.say(`Shared ${title} to X. Keep it viral!`, 10);
    this.addDripPoints(10);
  }

  showPlaylist() {
    this.playlistContent.innerHTML = this.playlist.map((track, index) => {
      const isDisabled = track.needsReload;
      const buttonText = isDisabled ? '⚠️' : '▶️';
      const buttonAction = isDisabled ? 'roger.promptFileReload()' : `roger.playTrack(${index})`;
      const titleText = isDisabled ? `${track.title} (needs re-loading)` : track.title;
      const buttonClass = isDisabled ? 'warning' : '';
      
      return `
        <div class="playlist-track ${isDisabled ? 'disabled' : ''}">
          <img src="${track.cover || 'https://picsum.photos/50/50'}" alt="Cover" style="width: 50px; height: 50px; border-radius: 4px;">
          <span>${titleText}</span>
          <button class="${buttonClass}" onclick="${buttonAction}" ${isDisabled ? 'title="File needs to be re-loaded"' : ''}>${buttonText}</button>
        </div>
      `;
    }).join('');
    this.playlistModalBackdrop.style.display = 'flex';
    this.say('Playlist open. Pick your vibe!', 3);
  }

  hidePlaylist() {
    this.playlistModalBackdrop.style.display = 'none';
    this.say('Playlist closed. Keep the vibes flowing.', 2);
  }

  promptFileReload() {
    this.say('Please re-load your local files using the "Load Files" button.', 0);
    this.hidePlaylist();
    document.getElementById('filePicker').click();
  }

  playTrack(index) {
    if (index < 0 || index >= this.playlist.length) return;
    
    const track = this.playlist[index];
    
    if (track.needsReload) {
      this.say('This track needs to be re-loaded. Use "Load Files" button.', 0);
      this.promptFileReload();
      return;
    }
    
    this.audioPlayer.src = track.src;
    this.audioTrackTitle.textContent = track.title;
    this.audioOverlay.style.display = 'block';
    this.audioPlayer.play().catch(() => this.say('Playback needs interaction.', 0));
    this.currentTrackIndex = index;
    this.say(`Playing ${track.title}.`, 3);
  }

  toggleAudioPlayback() {
    if (this.audioPlayer.paused) {
      this.audioPlayer.play();
      this.audioPlayPauseBtn.textContent = '⏸️';
      this.say('Track playing. Vibe on!', 2);
    } else {
      this.audioPlayer.pause();
      this.audioPlayPauseBtn.textContent = '▶️';
      this.say('Track paused. Chill mode.', 2);
    }
  }

  previousTrack() {
    let prevIndex = this.currentTrackIndex - 1;
    while (prevIndex >= 0 && this.playlist[prevIndex].needsReload) {
      prevIndex--;
    }
    if (prevIndex >= 0) {
      this.playTrack(prevIndex);
    } else {
      this.say('No previous track available.', 1);
    }
  }

  nextTrack() {
    let nextIndex = this.currentTrackIndex + 1;
    while (nextIndex < this.playlist.length && this.playlist[nextIndex].needsReload) {
      nextIndex++;
    }
    if (nextIndex < this.playlist.length) {
      this.playTrack(nextIndex);
    } else {
      this.say('End of playlist reached.', 1);
      this.closeAudioPlayer();
    }
  }

  closeAudioPlayer() {
    this.audioOverlay.style.display = 'none';
    this.audioPlayer.pause();
    this.audioTrackTitle.textContent = 'No track loaded';
    this.audioTime.textContent = '00:00 / 00:00';
    this.audioProgressBar.style.width = '0%';
    this.audioPlayPauseBtn.textContent = '▶️';
    this.say('Audio player closed. Silence is a vibe.', 2);
  }

  seekAudio(e) {
    const bar = e.currentTarget;
    const rect = bar.getBoundingClientRect();
    const percent = (e.clientX - rect.left) / rect.width;
    this.audioPlayer.currentTime = percent * this.audioPlayer.duration;
    this.say('Scrubbed to new vibe!', 2);
  }

  formatTime(sec) {
    const m = Math.floor(sec / 60).toString().padStart(2, '0');
    const s = Math.floor(sec % 60).toString().padStart(2, '0');
    return `${m}:${s}`;
  }

  handleFileLoad(files) {
    if (!files || files.length === 0) return;
    let audioFilesFound = 0;
    const newTracks = [];
    
    for (const file of files) {
      const url = URL.createObjectURL(file);
      const fileId = `${file.name}_${file.size}_${file.lastModified}`;
      
      // Store file reference for potential re-loading
      this.loadedFiles.set(fileId, {
        name: file.name,
        size: file.size,
        type: file.type,
        lastModified: file.lastModified
      });
      
      const trackData = {
        id: fileId,
        src: url,
        title: `📁 ${file.name}`,
        cover: 'https://picsum.photos/50/50',
        isLocal: true,
        fileName: file.name,
        fileType: file.type
      };
      
      if (file.type.startsWith('audio/')) {
        // Check if this file already exists in playlist (by ID) and update it
        const existingIndex = this.playlist.findIndex(t => t.id === fileId);
        if (existingIndex >= 0) {
          this.playlist[existingIndex] = trackData; // Update existing track
        } else {
          this.addToPlaylist(trackData); // Add new track
        }
        newTracks.push(trackData);
        audioFilesFound++;
      } else if (file.type.startsWith('video/')) {
        this.loadMedia('video', url, `📁 ${file.name}`);
      } else if (file.type.startsWith('image/')) {
        this.loadMedia('image', url, `📁 ${file.name}`);
      }
    }
    
    // Save to persistent storage (metadata only)
    this.savePersistentPlaylist();
    
    // Remove any missing files notifications
    const notifications = document.querySelectorAll('.missing-files-notification');
    notifications.forEach(n => n.remove());
    
    if (audioFilesFound > 0 && this.currentTrackIndex === -1) {
      const firstPlayableIndex = this.playlist.findIndex(t => !t.needsReload);
      if (firstPlayableIndex >= 0) this.playTrack(firstPlayableIndex);
    }
    
    this.say(`${files.length} file(s) processed. ${audioFilesFound} audio track(s) added and saved.`, audioFilesFound * 2);
  }

  addToPlaylist(track) {
    if (!this.playlist.some(t => t.src === track.src || t.id === track.id)) {
      this.playlist.push(track);
      this.savePersistentPlaylist();
    }
  }

  savePersistentPlaylist() {
    // Save only metadata, not blob URLs which become invalid
    const persistentData = this.playlist.map(track => ({
      id: track.id || track.src,
      title: track.title,
      cover: track.cover,
      isLocal: track.isLocal || false,
      fileName: track.fileName,
      fileType: track.fileType,
      src: track.isLocal ? null : track.src // Don't save blob URLs
    }));
    
    localStorage.setItem('persistentPlaylist', JSON.stringify(persistentData));
  }

  loadPersistedPlaylist() {
    if (this.persistentPlaylist.length === 0) return;
    
    let localFilesCount = 0;
    let loadedCount = 0;
    
    this.persistentPlaylist.forEach(trackData => {
      if (trackData.isLocal) {
        localFilesCount++;
        // Add placeholder for local files that need re-loading
        this.playlist.push({
          ...trackData,
          src: null,
          needsReload: true
        });
      } else {
        // Non-local files can be loaded directly
        this.playlist.push(trackData);
        loadedCount++;
      }
    });
    
    if (localFilesCount > 0) {
      this.say(`Found ${localFilesCount + loadedCount} saved tracks. ${localFilesCount} local files need re-loading.`, 3);
      this.showMissingFilesNotification(localFilesCount);
    } else if (loadedCount > 0) {
      this.say(`Loaded ${loadedCount} saved tracks from previous session.`, 5);
    }
  }

  showMissingFilesNotification(count) {
    // Add a notification button to re-load missing files
    const notification = document.createElement('div');
    notification.className = 'missing-files-notification';
    notification.innerHTML = `
      <p>⚠️ ${count} local audio files from your previous session need to be re-loaded.</p>
      <button onclick="document.getElementById('filePicker').click(); this.parentElement.remove();" 
              style="background: white; color: var(--hot); border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
        Re-load Files
      </button>
      <button onclick="roger.clearLocalTracks(); this.parentElement.remove();" 
              style="background: transparent; color: white; border: 1px solid white; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; margin-left: 0.5rem;">
        Clear Missing Files
      </button>
    `;
    
    this.mediaOutput.insertBefore(notification, this.mediaOutput.firstChild);
  }

  clearLocalTracks() {
    this.playlist = this.playlist.filter(track => !track.needsReload);
    this.savePersistentPlaylist();
    this.currentTrackIndex = -1;
    this.closeAudioPlayer();
    this.say('Cleared missing local files from playlist.', 2);
  }

  clearPlaylist() {
    this.playlist = [];
    this.persistentPlaylist = [];
    this.loadedFiles.clear();
    localStorage.removeItem('persistentPlaylist');
    this.currentTrackIndex = -1;
    this.closeAudioPlayer();
    
    // Remove any notifications
    const notifications = document.querySelectorAll('.missing-files-notification');
    notifications.forEach(n => n.remove());
    
    this.say('Playlist cleared. Fresh vibes incoming!', 3);
  }
}

const roger = new RogerMediaHub();
  </script>
</body>
</html>
