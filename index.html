<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>P.O.P.S. Media Hub - Professional Multi-Tab Browser</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #7c3aed;
      --primary-light: #a855f7;
      --primary-dark: #5b21b6;
      --secondary: #06b6d4;
      --accent: #f59e0b;
      --bg-dark: #0f172a;
      --bg-card: #1e293b;
      --bg-hover: #334155;
      --text-primary: #f8fafc;
      --text-muted: #94a3b8;
      --border: #334155;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--bg-dark) 0%, #1e293b 100%);
      color: var(--text-primary);
      overflow-x: hidden;
    }

    #app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 1rem;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1200px;
      margin: 0 auto;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .logo-text {
      font-size: 1.25rem;
      font-weight: 600;
      background: linear-gradient(135deg, var(--primary-light), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--bg-hover);
      border-radius: 1rem;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: var(--success);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .roger-interface {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 1rem;
      position: sticky;
      top: 73px;
      z-index: 99;
    }

    .roger-input-container {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      max-width: 800px;
      margin: 0 auto;
    }

    .roger-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--accent), var(--warning));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
    }

    #rogerInput {
      flex: 1;
      background: var(--bg-hover);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 0.75rem 1rem;
      color: var(--text-primary);
      font-size: 1rem;
    }

    #rogerInput:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
    }

    .roger-mic, .roger-send {
      background: var(--primary);
      border: none;
      border-radius: 0.75rem;
      padding: 0.75rem;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .roger-mic:hover, .roger-send:hover {
      background: var(--primary-light);
      transform: translateY(-1px);
    }

    .roger-mic.active {
      background: var(--error);
      animation: pulse 1s infinite;
    }

    #rogerResponse {
      max-width: 800px;
      margin: 1rem auto 0;
      background: var(--bg-hover);
      border-radius: 1rem;
      padding: 1rem;
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    #rogerResponse.active {
      opacity: 1;
      transform: translateY(0);
    }

    .roger-share {
      background: var(--secondary);
      border: none;
      border-radius: 0.5rem;
      padding: 0.5rem;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
    }

    .roger-share:hover {
      background: #0891b2;
      transform: scale(1.1);
    }

    .roger-suggestions {
      max-width: 800px;
      margin: 0.5rem auto 0;
      background: var(--bg-card);
      border-radius: 1rem;
      border: 1px solid var(--border);
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s;
      overflow: hidden;
    }

    .roger-suggestions.active {
      opacity: 1;
      transform: translateY(0);
    }

    .suggestion-item {
      padding: 0.75rem 1rem;
      cursor: pointer;
      border-bottom: 1px solid var(--border);
      transition: background 0.2s;
    }

    .suggestion-item:hover {
      background: var(--bg-hover);
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    .main-content {
      display: flex;
      flex: 1;
      min-height: 0;
    }

    .sidebar {
      width: 320px;
      background: var(--bg-card);
      border-right: 1px solid var(--border);
      transition: transform 0.3s;
      position: relative;
      overflow-y: auto;
    }

    .sidebar.collapsed {
      transform: translateX(-100%);
    }

    .sidebar-toggle {
      position: absolute;
      right: -40px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--primary);
      border: none;
      border-radius: 0 0.5rem 0.5rem 0;
      padding: 1rem 0.5rem;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      z-index: 10;
    }

    .sidebar-toggle:hover {
      background: var(--primary-light);
    }

    .sidebar-toggle.collapsed {
      transform: translateY(-50%) rotate(180deg);
    }

    .sidebar-section {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .sidebar-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }

    /* Leaderboard Styles */
    .leaderboard-section {
      background: var(--bg-card);
      border-radius: 1rem;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .leaderboard-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .drip-counter {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: linear-gradient(135deg, var(--accent), var(--warning));
      border-radius: 1rem;
      padding: 0.5rem 1rem;
      font-weight: 600;
      animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from { box-shadow: 0 0 5px rgba(245, 158, 11, 0.5); }
      to { box-shadow: 0 0 20px rgba(245, 158, 11, 0.8); }
    }

    .leaderboard-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .leaderboard-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg-hover);
      border-radius: 0.75rem;
      padding: 0.75rem;
      transition: all 0.2s;
    }

    .leaderboard-item:first-child {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      font-weight: 600;
    }

    .leaderboard-item:hover {
      transform: translateX(4px);
    }

    .media-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .media-panel {
      background: var(--bg-hover);
      border-radius: 1rem;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .media-panel:hover {
      background: var(--primary);
      transform: translateY(-2px);
    }

    .media-panel-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      display: block;
    }

    .media-panel-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .media-panel-desc {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .quick-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .quick-action {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: var(--bg-hover);
      border-radius: 0.75rem;
      padding: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quick-action:hover {
      background: var(--primary);
      transform: translateX(4px);
    }

    .viewer {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      background: var(--bg-dark);
    }

    .browser-controls {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 0.75rem;
      opacity: 0;
      transform: translateY(-100%);
      transition: all 0.3s;
    }

    .browser-controls.active {
      opacity: 1;
      transform: translateY(0);
    }

    .browser-nav-top {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-btn {
      background: var(--bg-hover);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      padding: 0.5rem 0.75rem;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .nav-btn:hover:not(:disabled) {
      background: var(--primary);
      border-color: var(--primary);
    }

    .nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .address-bar {
      flex: 1;
      background: var(--bg-hover);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      padding: 0.5rem 1rem;
      color: var(--text-primary);
      font-size: 0.95rem;
    }

    .address-bar:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.1);
    }

    .tabs-container-wrapper {
      display: flex;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
    }

    .tabs-container {
      display: flex;
      flex: 1;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .tabs-container::-webkit-scrollbar {
      display: none;
    }

    .tab-item {
      display: flex;
      align-items: center;
      background: var(--bg-hover);
      border-right: 1px solid var(--border);
      padding: 0.75rem 1rem;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 150px;
      max-width: 200px;
    }

    .tab-item.active {
      background: var(--bg-dark);
    }

    .tab-item:hover {
      background: var(--primary);
    }

    .tab-title {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-right: 0.5rem;
    }

    .tab-close {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 1.2rem;
      padding: 0;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .tab-close:hover {
      background: var(--error);
      color: white;
    }

    .new-tab-btn {
      background: var(--bg-hover);
      border: none;
      border-left: 1px solid var(--border);
      padding: 0.75rem 1rem;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1.2rem;
    }

    .new-tab-btn:hover {
      background: var(--primary);
    }

    .viewer-content-area {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    .viewer-content {
      width: 100%;
      height: 100%;
      border: none;
    }

    .viewer-content.active {
      display: block;
    }

    .viewer-content:not(.active) {
      display: none;
    }

    .viewer-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      text-align: center;
      padding: 2rem;
    }

    .viewer-placeholder-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.7;
    }

    .viewer-placeholder-text {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .viewer-placeholder-desc {
      color: var(--text-muted);
      font-size: 1rem;
    }

    .audio-overlay {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1rem;
      min-width: 300px;
      opacity: 0;
      transform: translateY(100%);
      transition: all 0.3s;
      z-index: 1000;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .audio-overlay.active {
      opacity: 1;
      transform: translateY(0);
    }

    .audio-player-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .audio-player-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
    }

    .audio-close-btn {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 1.5rem;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .audio-close-btn:hover {
      background: var(--error);
      color: white;
    }

    .audio-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .audio-btn {
      background: var(--bg-hover);
      border: 1px solid var(--border);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .audio-btn:hover {
      background: var(--primary);
      border-color: var(--primary);
      transform: scale(1.1);
    }

    .audio-btn.play-pause {
      width: 50px;
      height: 50px;
      background: var(--primary);
      border-color: var(--primary);
    }

    .audio-info {
      flex: 1;
      min-width: 0;
    }

    .audio-track-title {
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 0.25rem;
    }

    .audio-time {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .audio-progress {
      height: 6px;
      background: var(--bg-hover);
      border-radius: 3px;
      cursor: pointer;
      overflow: hidden;
    }

    .audio-progress-bar {
      height: 100%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 3px;
      width: 0%;
      transition: width 0.1s;
    }

    .drop-zone {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
      z-index: 2000;
    }

    .drop-zone.active {
      opacity: 1;
      pointer-events: all;
    }

    .drop-zone-content {
      background: var(--bg-card);
      border: 2px dashed var(--primary);
      border-radius: 2rem;
      padding: 3rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: 600;
    }

    .playlist-modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
      z-index: 2000;
      padding: 1rem;
    }

    .playlist-modal-backdrop.active {
      opacity: 1;
      pointer-events: all;
    }

    .playlist-modal {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      max-width: 500px;
      width: 100%;
      max-height: 600px;
      display: flex;
      flex-direction: column;
    }

    .playlist-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .playlist-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .playlist-close-btn {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 1.5rem;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .playlist-close-btn:hover {
      background: var(--error);
      color: white;
    }

    .playlist-content {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    .playlist-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: var(--bg-hover);
      border-radius: 0.75rem;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .playlist-item:hover {
      background: var(--primary);
    }

    .playlist-item.playing {
      background: var(--primary);
      border: 1px solid var(--primary-light);
    }

    .playlist-item-title {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .playlist-item-controls {
      display: flex;
      gap: 0.25rem;
    }

    .playlist-item-controls button {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 0.25rem;
      padding: 0.25rem 0.5rem;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.75rem;
    }

    .playlist-item-controls button:hover:not(:disabled) {
      background: var(--secondary);
      border-color: var(--secondary);
    }

    .playlist-item-controls button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 1rem;
      }

      .logo-text {
        font-size: 1rem;
      }

      .roger-interface {
        position: static;
      }

      .roger-input-container {
        flex-wrap: wrap;
      }

      #rogerInput {
        min-width: 200px;
      }

      .main-content {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        z-index: 200;
        transform: translateX(-100%);
      }

      .sidebar.show {
        transform: translateX(0);
      }

      .sidebar-toggle {
        position: fixed;
        right: 1rem;
        bottom: 1rem;
        border-radius: 50%;
        width: 56px;
        height: 56px;
        z-index: 201;
      }

      .media-grid {
        grid-template-columns: 1fr;
      }

      .browser-nav-top {
        flex-wrap: wrap;
      }

      .address-bar {
        min-width: 200px;
      }

      .tabs-container-wrapper {
        flex-direction: column;
      }

      .tab-item {
        min-width: 120px;
        max-width: 150px;
      }

      .audio-overlay {
        bottom: 0;
        left: 0;
        right: 0;
        border-radius: 1rem 1rem 0 0;
        min-width: auto;
      }

      .playlist-modal {
        margin: 1rem;
        max-height: calc(100vh - 2rem);
      }

      .leaderboard-section {
        margin: 0.5rem;
      }

      .drip-counter {
        font-size: 0.875rem;
        padding: 0.375rem 0.75rem;
      }
    }

    @media (max-width: 480px) {
      .roger-input-container {
        gap: 0.5rem;
      }

      .roger-avatar {
        width: 32px;
        height: 32px;
        font-size: 0.875rem;
      }

      #rogerInput {
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
      }

      .roger-mic, .roger-send {
        padding: 0.5rem;
      }

      .media-panel {
        padding: 0.75rem;
      }

      .media-panel-icon {
        font-size: 1.5rem;
      }

      .quick-action {
        padding: 0.5rem;
        font-size: 0.875rem;
      }

      .viewer-placeholder-icon {
        font-size: 3rem;
      }

      .viewer-placeholder-text {
        font-size: 1.25rem;
      }

      .audio-controls {
        gap: 0.5rem;
      }

      .audio-btn {
        width: 36px;
        height: 36px;
      }

      .audio-btn.play-pause {
        width: 44px;
        height: 44px;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon">P</div>
          <div class="logo-text">P.O.P.S. Media Hub</div>
        </div>
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span id="statusText">System Online</span>
        </div>
      </div>
    </header>

    <div class="roger-interface">
      <div class="roger-input-container">
        <div class="roger-avatar">R</div>
        <input id="rogerInput" placeholder="Ask Roger... try 'load folder' or 'playlist'" />
        <button class="roger-mic" onclick="hubInstance.startVoiceCommand()" title="Voice Command">
          <span class="mic-icon">🎙️</span>
        </button>
        <button class="roger-send" onclick="hubInstance.processRogerCommand()">Send</button>
      </div>
      <div id="rogerResponse">
        <span id="rogerResponseText"></span>
        <button class="roger-share" onclick="hubInstance.shareRogerResponse()" title="Share to X">📤</button>
      </div>
      <div class="roger-suggestions" id="rogerSuggestions"></div>
    </div>

    <div class="main-content">
      <div class="sidebar" id="sidebar">
        <button class="sidebar-toggle" id="sidebarToggle" title="Toggle Sidebar">◀</button>
        
        <!-- Leaderboard Section -->
        <div class="sidebar-section">
          <div class="leaderboard-section">
            <div class="leaderboard-header">
              <div class="sidebar-title">🏆 Drip Leaderboard</div>
              <div class="drip-counter">
                <span>💎</span>
                <span id="dripPoints">0</span>
                <span>Drip</span>
              </div>
            </div>
            <div class="leaderboard-list" id="leaderboardList">
              <div class="leaderboard-item">@mackcwm - 0 Drip</div>
            </div>
          </div>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-title">Media Library</div>
          <div class="media-grid">
            <div class="media-panel" onclick="loadMedia('video', 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4', '🎬 Big Buck Bunny')">
              <span class="media-panel-icon">🎬</span>
              <div class="media-panel-title">Movies</div>
              <div class="media-panel-desc">HD Collection</div>
            </div>
            <div class="media-panel" onclick="hubInstance.playBackgroundMusic('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3', '🎵 Sample Track')">
              <span class="media-panel-icon">🎵</span>
              <div class="media-panel-title">Music</div>
              <div class="media-panel-desc">Playlist Ready</div>
            </div>
            <div class="media-panel" onclick="loadMedia('image', 'https://picsum.photos/1200/800?random=1', '🖼️ Random Art')">
              <span class="media-panel-icon">🖼️</span>
              <div class="media-panel-title">Photos</div>
              <div class="media-panel-desc">Gallery View</div>
            </div>
            <div class="media-panel" onclick="hubInstance.openBrowser()">
              <span class="media-panel-icon">🌐</span>
              <div class="media-panel-title">Web Browser</div>
              <div class="media-panel-desc">Multi-Tab</div>
            </div>
          </div>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-title">Quick Actions</div>
          <div class="quick-actions">
            <div class="quick-action" onclick="hubInstance.loadMusicFolder()">
              <span>📂</span> <span>Load Folder</span>
            </div>
            <div class="quick-action" onclick="document.getElementById('filePicker').click()">
              <span>➕</span> <span>Load Files</span>
            </div>
            <div class="quick-action" onclick="hubInstance.showPlaylist()">
              <span>🎶</span> <span>Show Playlist</span>
            </div>
            <div class="quick-action" onclick="toggleFullscreen()">
              <span>⛶</span> <span>Toggle Fullscreen</span>
            </div>
            <div class="quick-action" onclick="hubInstance.toggleRogerMood()">
              <span>😎</span> <span>Toggle Roger Mood</span>
            </div>
          </div>
        </div>
      </div>

      <div class="viewer" id="viewer">
        <div class="browser-controls" id="browserControls">
          <div class="browser-nav-top">
            <button class="nav-btn" id="backBtn" onclick="hubInstance.browserBack()" disabled title="Back">←</button>
            <button class="nav-btn" id="forwardBtn" onclick="hubInstance.browserForward()" disabled title="Forward">→</button>
            <button class="nav-btn" onclick="hubInstance.browserReload()" title="Reload">↻</button>
            <button class="nav-btn" onclick="hubInstance.browserHome()" title="Home">🏠</button>
            <input 
              type="text" 
              class="address-bar" 
              id="addressBar" 
              placeholder="Enter website URL..."
              onkeydown="if(event.key==='Enter') hubInstance.navigateToUrl()"
            />
          </div>
        </div>
        
        <div class="tabs-container-wrapper">
          <div class="tabs-container" id="tabsContainer"></div>
          <button class="new-tab-btn" id="newTabBtn" title="New Tab (Ctrl+T)">+</button>
        </div>

        <div class="viewer-content-area" id="viewerContentArea">
          <div class="viewer-placeholder" id="viewerPlaceholder">
            <div class="viewer-placeholder-icon">🚀</div>
            <div class="viewer-placeholder-text">Ready for Launch</div>
            <div class="viewer-placeholder-desc">Select media or ask Roger to get started</div>
          </div>
        </div>

        <div class="floating-controls" id="floatingControls"></div>
      </div>
    </div>

    <div class="audio-overlay" id="audioOverlay">
      <div class="audio-player-header">
        <div class="audio-player-title">
          <span>🎵</span>
          <span>Now Playing</span>
        </div>
        <button class="audio-close-btn" onclick="hubInstance.closeAudioPlayer()" title="Close Player">×</button>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="hubInstance.previousTrack()" title="Previous">⏮️</button>
        <button class="audio-btn play-pause" onclick="hubInstance.toggleAudioPlayback()" id="audioPlayPauseBtn" title="Play/Pause">▶️</button>
        <button class="audio-btn" onclick="hubInstance.nextTrack()" title="Next">⏭️</button>
        <div class="audio-info">
          <div class="audio-track-title" id="audioTrackTitle">No track loaded</div>
          <div class="audio-time" id="audioTime">00:00 / 00:00</div>
        </div>
      </div>
      <div class="audio-progress" onclick="hubInstance.seekAudio(event)">
        <div class="audio-progress-bar" id="audioProgressBar"></div>
      </div>
    </div>

    <div class="drop-zone" id="dropZone">
      <div class="drop-zone-content">
        <div>📁 Drop files to load</div>
      </div>
    </div>
    
    <div class="playlist-modal-backdrop" id="playlistModalBackdrop">
      <div class="playlist-modal">
        <div class="playlist-header">
          <div class="playlist-title">Music Playlist</div>
          <button class="playlist-close-btn" id="playlistCloseBtn">×</button>
        </div>
        <div class="playlist-content" id="playlistContent"></div>
      </div>
    </div>
  </div>

  <input type="file" id="filePicker" accept="audio/*,video/*,image/*" style="display:none" multiple />
  
  <script>
class POPSMediaHub {
  constructor() {
    this.viewerContentArea = document.getElementById('viewerContentArea');
    this.viewerPlaceholder = document.getElementById('viewerPlaceholder');
    this.rogerInput = document.getElementById('rogerInput');
    this.rogerResponse = document.getElementById('rogerResponseText');
    this.rogerSuggestions = document.getElementById('rogerSuggestions');
    this.filePicker = document.getElementById('filePicker');
    this.dropZone = document.getElementById('dropZone');
    this.sidebar = document.getElementById('sidebar');
    this.sidebarToggle = document.getElementById('sidebarToggle');
    this.browserControls = document.getElementById('browserControls');
    this.addressBar = document.getElementById('addressBar');
    this.backBtn = document.getElementById('backBtn');
    this.forwardBtn = document.getElementById('forwardBtn');
    this.tabsContainer = document.getElementById('tabsContainer');
    this.newTabBtn = document.getElementById('newTabBtn');
    this.audioOverlay = document.getElementById('audioOverlay');
    this.backgroundAudio = new Audio();
    this.audioTrackTitle = document.getElementById('audioTrackTitle');
    this.audioTime = document.getElementById('audioTime');
    this.audioProgressBar = document.getElementById('audioProgressBar');
    this.dripPointsDisplay = document.getElementById('dripPoints');
    this.audioPlayPauseBtn = document.getElementById('audioPlayPauseBtn');
    this.playlistModalBackdrop = document.getElementById('playlistModalBackdrop');
    this.playlistContent = document.getElementById('playlistContent');
    this.playlistCloseBtn = document.getElementById('playlistCloseBtn');
    this.isOnline = navigator.onLine;
    this.tabs = [];
    this.activeTabId = null;
    this.isBrowserActive = false;
    this.defaultUrl = 'https://www.wikipedia.com';
    this.leaderboard = [{ name: '@mackcwm', points: 0 }];
    this.playlist = [];
    this.currentTrackIndex = -1;
    this.rogerMood = 'MackGPT';
    this.dripPoints = 0;
    this.grokAPIKey = null;
    this.mockGrokData = { 
      playlists: [{ title: 'Neon Vibe Mix', src: 'https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3' }], 
      art: [{ title: 'Neon Akron Glow', src: 'https://picsum.photos/1200/800?random=1' }] 
    };
    this.init();
  }

  init() {
    this.setupEventListeners();
    this.initRoger();
    this.setupDragDrop();
    this.updateLeaderboard();
    this.setupAudioPlayer();
    this.rogerSay("Welcome to P.O.P.S. Media Hub! Say 'generate playlist' or 'go chaotic' and share with #POPSvibe to climb the Drip leaderboard. Vibe master, let's roll!", 5);
  }

  setupEventListeners() {
    this.rogerInput.addEventListener('keydown', (e) => e.key === 'Enter' && this.processRogerCommand());
    this.rogerInput.addEventListener('input', () => this.showSuggestions());
    this.filePicker.addEventListener('change', (e) => this.handleFileLoad(e.target.files));
    this.sidebarToggle.addEventListener('click', () => this.toggleSidebar());
    this.newTabBtn.addEventListener('click', () => this.createNewTab());
    this.playlistCloseBtn.addEventListener('click', () => this.hidePlaylist());

    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key.toLowerCase()) {
          case 'o': e.preventDefault(); this.filePicker.click(); break;
          case 'f': e.preventDefault(); this.toggleFullscreen(); break;
          case 't': if (this.isBrowserActive) { e.preventDefault(); this.createNewTab(); } break;
          case 'w': if (this.isBrowserActive && this.activeTabId) { e.preventDefault(); this.closeTab(this.activeTabId); } break;
        }
      }
    });

    if (window.innerWidth <= 768) {
      this.sidebar.addEventListener('click', (e) => e.stopPropagation());
      document.addEventListener('click', (e) => {
        if (this.sidebar.classList.contains('show') && !this.sidebar.contains(e.target) && !this.sidebarToggle.contains(e.target)) {
          this.sidebar.classList.remove('show');
        }
      });
    }
  }

  setupDragDrop() {
    let dragCounter = 0;
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      document.addEventListener(eventName, e => {
        e.preventDefault();
        e.stopPropagation();
      });
    });
    document.addEventListener('dragenter', () => { dragCounter++; this.dropZone.classList.add('active'); });
    document.addEventListener('dragleave', () => { dragCounter--; if (dragCounter === 0) this.dropZone.classList.remove('active'); });
    document.addEventListener('drop', e => {
      dragCounter = 0;
      this.dropZone.classList.remove('active');
      this.handleFileLoad(e.dataTransfer.files);
    });
  }

  initRoger() {
    this.rogerCommands = {
      'play music': () => this.playBackgroundMusic('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3', 'Roger\'s Choice'),
      'browse web': () => this.openBrowser(),
      'new tab': () => this.isBrowserActive ? this.createNewTab() : this.rogerSay("Open browser first.", 0, true),
      'close tab': () => this.isBrowserActive ? this.closeTab(this.activeTabId) : this.rogerSay("No active tab.", 0, true),
      'clear': () => this.clearViewer(),
      'fullscreen': () => this.toggleFullscreen(),
      'collapse sidebar': () => this.toggleSidebar(true),
      'expand sidebar': () => this.toggleSidebar(false),
      'playlist': () => this.showPlaylist(),
      'load folder': () => this.loadMusicFolder(),
      'toggle mood': () => this.toggleRogerMood(),
      'go chaotic': () => {
        this.rogerMood = 'LackGPT';
        this.rogerSay("Chaos mode activated. Let's get weird.", 5);
      },
      'ask grok': async () => {
        if (!this.grokAPIKey) {
          this.rogerSay("Grok API not configured yet. Stay tuned for the collab vibe!", 0, true);
          return;
        }
        this.rogerSay("Grok API vibes incoming! Dropped a neon art piece.", 5);
        this.loadMedia('image', this.mockGrokData.art[0].src, this.mockGrokData.art[0].title);
      },
      'generate playlist': async () => {
        if (!this.grokAPIKey) {
          this.rogerSay("Grok API not ready yet. Try loading a folder for now!", 0, true);
          return;
        }
        this.rogerSay(`Generated ${this.rogerMood}-inspired playlist! Vibe on.`, 5);
        this.addToPlaylist(this.mockGrokData.playlists[0]);
        if (this.currentTrackIndex === -1) {
          this.playTrack(this.playlist.length - 1);
        }
      }
    };
    
    this.moodResponses = {
      MackGPT: {
        default: "Yo, you're crushing it! Let's drop that vibe! 🚀",
        error: "Whoa, vibe check failed! Try a new command, champ."
      },
      LackGPT: {
        default: "Pfft, you call that a command? Let's see something with more chaos.",
        error: "Yawn, that didn't work. Try not to bore me next time."
      },
      GuideGPT: {
        default: "All set! What do you want to explore next?",
        error: "Hmm, that command didn't work. Try 'play music' or 'new tab'."
      }
    };
  }

  toggleSidebar(forceState = null) {
    const isMobile = window.innerWidth <= 768;
    
    if (isMobile) {
      this.sidebar.classList.toggle('show');
      this.rogerSay(this.sidebar.classList.contains('show') ? "Sidebar opened." : "Sidebar closed.", 2);
    } else {
      const isCollapsed = forceState !== null ? forceState : this.sidebar.classList.contains('collapsed');
      this.sidebar.classList.toggle('collapsed', !isCollapsed);
      this.sidebarToggle.classList.toggle('collapsed', !isCollapsed);
      this.rogerSay(isCollapsed ? "Sidebar expanded. Vibe wide open!" : "Sidebar collapsed. Streamlined flow.", 2);
    }
  }

  processRogerCommand() {
    const input = this.rogerInput.value.toLowerCase().trim();
    if (!input) return;
    this.rogerInput.value = '';
    this.rogerSuggestions.classList.remove('active');

    let found = false;
    for (const [command, action] of Object.entries(this.rogerCommands)) {
      if (input.includes(command)) {
        action();
        this.addDripPoints(2);
        found = true;
        break;
      }
    }
    if (!found) this.rogerSay(`Command "${input}" not recognized.`, 0, true);
  }

  rogerSay(message, dripPoints = 0, isError = false) {
    const responseKey = isError ? 'error' : 'default';
    const prefix = this.moodResponses[this.rogerMood][responseKey];
    this.rogerResponse.textContent = `Roger: ${prefix} ${message}${dripPoints > 0 ? ` (+${dripPoints} Drip)` : ''}`;
    this.rogerResponse.parentElement.classList.add('active');
    setTimeout(() => this.rogerResponse.parentElement.classList.remove('active'), 5000);
    if (dripPoints > 0) this.addDripPoints(dripPoints);
  }

  addDripPoints(points) {
    this.dripPoints += points;
    this.updateLeaderboard();
  }

  updateLeaderboard() {
    this.dripPointsDisplay.textContent = this.dripPoints;
    this.leaderboard[0].points = this.dripPoints;
    const leaderboardList = document.getElementById('leaderboardList');
    leaderboardList.innerHTML = this.leaderboard
      .sort((a, b) => b.points - a.points)
      .slice(0, 5)
      .map((item, index) => `<div class="leaderboard-item">${index === 0 ? '👑 ' : ''}${item.name} - ${item.points} Drip</div>`)
      .join('');
  }

  startVoiceCommand() {
    if (!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) {
      this.rogerSay("Voice commands not supported. Type it out, vibe master!", 0, true);
      return;
    }
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    const rogerMic = document.querySelector('.roger-mic');
    rogerMic.classList.add('active');

    recognition.onresult = (e) => {
      const command = e.results[0][0].transcript.toLowerCase();
      this.rogerInput.value = command;
      this.processRogerCommand();
      rogerMic.classList.remove('active');
      this.addDripPoints(3);
    };
    recognition.onerror = (e) => {
      this.rogerSay(`Voice error: ${e.error}. Try typing your vibe.`, 0, true);
      rogerMic.classList.remove('active');
    };
    recognition.onend = () => rogerMic.classList.remove('active');
    recognition.start();
    this.rogerSay("Listening for your vibe...");
  }

  showSuggestions() {
    const input = this.rogerInput.value.toLowerCase().trim();
    if (input.length < 2) {
      this.rogerSuggestions.classList.remove('active');
      return;
    }
    const suggestions = Object.keys(this.rogerCommands).filter(cmd => cmd.includes(input));
    this.rogerSuggestions.innerHTML = suggestions.length
      ? suggestions.map(cmd => `<div class="suggestion-item" onclick="hubInstance.rogerInput.value='${cmd}';hubInstance.processRogerCommand()">${cmd}</div>`).join('')
      : '<div class="suggestion-item">No matching commands</div>';
    this.rogerSuggestions.classList.add('active');
  }

  toggleRogerMood() {
    const moods = ['MackGPT', 'LackGPT', 'GuideGPT'];
    this.rogerMood = moods[(moods.indexOf(this.rogerMood) + 1) % moods.length];
    this.rogerSay(`Switched to ${this.rogerMood} mode. Let's vibe!`, 5);
  }

  shareRogerResponse() {
    const response = this.rogerResponse.textContent;
    const shareText = encodeURIComponent(`${response} #POPSvibe`);
    window.open(`https://x.com/intent/tweet?text=${shareText}`, '_blank');
    this.rogerSay("Shared your vibe to X! Keep it 💯.", 10);
    this.addDripPoints(10);
  }

  addToPlaylist(track) {
    if (!this.playlist.some(t => t.src === track.src)) {
      this.playlist.push(track);
    }
  }

  playTrack(index) {
    if (index < 0 || index >= this.playlist.length) return;
    this.currentTrackIndex = index;
    const track = this.playlist[index];
    this.backgroundAudio.src = track.src;
    this.audioTrackTitle.textContent = track.title;
    this.backgroundAudio.play().catch(e => this.rogerSay("Playback requires user interaction.", 0, true));
    this.audioOverlay.classList.add('active');
    if(this.playlistModalBackdrop.classList.contains('active')) this.renderPlaylist();
    this.rogerSay(`Playing ${track.title}.`, 3);
  }

  playBackgroundMusic(src, title) {
    this.addToPlaylist({src, title});
    this.playTrack(this.playlist.length - 1);
  }

  toggleAudioPlayback() {
    if (this.backgroundAudio.paused) {
      this.backgroundAudio.play();
      this.rogerSay("Track playing. Vibe on!", 2);
    } else {
      this.backgroundAudio.pause();
      this.rogerSay("Track paused. Chill mode.", 2);
    }
  }

  nextTrack() {
    this.playTrack((this.currentTrackIndex + 1) % this.playlist.length);
  }

  previousTrack() {
    this.playTrack((this.currentTrackIndex - 1 + this.playlist.length) % this.playlist.length);
  }

  closeAudioPlayer() {
    this.backgroundAudio.pause();
    this.backgroundAudio.src = '';
    this.audioOverlay.classList.remove('active');
    this.currentTrackIndex = -1;
    this.rogerSay("Audio player closed. Silence is a vibe too.", 2);
  }

  updateAudioProgress() {
    const { currentTime, duration } = this.backgroundAudio;
    if (duration) {
      this.audioProgressBar.style.width = `${(currentTime / duration) * 100}%`;
      this.audioTime.textContent = `${this.formatTime(currentTime)} / ${this.formatTime(duration)}`;
    }
  }

  seekAudio(event) {
    const { offsetWidth } = event.currentTarget;
    this.backgroundAudio.currentTime = (event.offsetX / offsetWidth) * this.backgroundAudio.duration;
    this.rogerSay("Scrubbed to new vibe!", 2);
  }

  showPlaylist() {
    this.renderPlaylist();
    this.playlistModalBackdrop.classList.add('active');
    this.rogerSay("Playlist open. Pick your vibe!", 3);
  }

  hidePlaylist() {
    this.playlistModalBackdrop.classList.remove('active');
    this.rogerSay("Playlist closed. Keep the vibes flowing.", 2);
  }

  renderPlaylist() {
    if (this.playlist.length === 0) {
      this.playlistContent.innerHTML = '<p style="text-align: center; color: var(--text-muted);">Playlist is empty. Load some music!</p>';
      return;
    }
    this.playlistContent.innerHTML = this.playlist.map((track, index) => `
      <div class="playlist-item ${index === this.currentTrackIndex ? 'playing' : ''}" data-index="${index}">
        <span>${index === this.currentTrackIndex ? '▶' : '🎵'}</span>
        <span class="playlist-item-title">${track.title}</span>
        <div class="playlist-item-controls">
          <button data-action="up" data-index="${index}" ${index === 0 ? 'disabled' : ''}>↑</button>
          <button data-action="down" data-index="${index}" ${index === this.playlist.length - 1 ? 'disabled' : ''}>↓</button>
          <button data-action="remove" data-index="${index}">×</button>
        </div>
      </div>
    `).join('');
    
    this.playlistContent.querySelectorAll('.playlist-item').forEach(el => {
      el.addEventListener('click', e => {
        const index = parseInt(el.dataset.index);
        const action = e.target.dataset.action;
        if (action === 'up') {
          this.moveTrack(index, -1);
          this.rogerSay("Track moved up. Vibe reordered!", 2);
        } else if (action === 'down') {
          this.moveTrack(index, 1);
          this.rogerSay("Track moved down. Vibe reordered!", 2);
        } else if (action === 'remove') {
          this.removeTrack(index);
          this.rogerSay("Track removed. Playlist streamlined.", 2);
        } else {
          this.playTrack(index);
        }
      });
    });
  }

  moveTrack(index, direction) {
    if (direction === -1 && index === 0) return;
    if (direction === 1 && index === this.playlist.length - 1) return;
    const newIndex = index + direction;
    [this.playlist[index], this.playlist[newIndex]] = [this.playlist[newIndex], this.playlist[index]];
    if(this.currentTrackIndex === index) this.currentTrackIndex = newIndex;
    else if(this.currentTrackIndex === newIndex) this.currentTrackIndex = index;
    this.renderPlaylist();
  }

  removeTrack(index) {
    this.playlist.splice(index, 1);
    if(this.currentTrackIndex === index) {
      this.playTrack(index % this.playlist.length);
    } else if (this.currentTrackIndex > index) {
      this.currentTrackIndex--;
    }
    this.renderPlaylist();
  }

  formatTime(s) { return new Date(s * 1000).toISOString().substr(14, 5); }

  loadMedia(type, src, title = 'Media') {
    this.exitBrowserMode();
    this.viewerContentArea.innerHTML = '';
    let element;
    switch(type) {
      case 'video': element = document.createElement('video'); element.controls = true; break;
      case 'image': element = document.createElement('img'); break;
    }
    element.src = src;
    element.className = 'viewer-content';
    this.viewerContentArea.appendChild(element);
    this.rogerSay(`Now displaying: ${title}`, 2);
  }

  clearViewer() {
    this.exitBrowserMode();
    this.viewerContentArea.innerHTML = '';
    this.viewerContentArea.appendChild(this.viewerPlaceholder);
    this.rogerSay("Viewer cleared.", 2);
  }

  handleFileLoad(files) {
    if (!files || files.length === 0) return;
    let audioFilesFound = 0;
    for(const file of files) {
      const url = URL.createObjectURL(file);
      if (file.type.startsWith('audio/')) {
        this.addToPlaylist({ src: url, title: `📁 ${file.name}` });
        audioFilesFound++;
      }
    }
    if (audioFilesFound > 0 && this.currentTrackIndex === -1) {
      this.playTrack(0);
    }
    this.rogerSay(`${files.length} file(s) processed. ${audioFilesFound} audio track(s) added to playlist.`, audioFilesFound * 2);
  }

  async loadMusicFolder() {
    if (!window.showDirectoryPicker) {
      this.rogerSay("Folder access is not supported by your browser.", 0, true);
      return;
    }
    try {
      const dirHandle = await window.showDirectoryPicker();
      let count = 0;
      for await (const entry of dirHandle.values()) {
        if (entry.kind === 'file') {
          const file = await entry.getFile();
          if (file.type.startsWith('audio/')) {
            const url = URL.createObjectURL(file);
            this.addToPlaylist({ src: url, title: `📁 ${file.name}` });
            count++;
          }
        }
      }
      if (count > 0 && this.currentTrackIndex === -1) {
        this.playTrack(0);
      }
      this.rogerSay(`Loaded ${count} tracks from the folder.`, count * 2);
    } catch (err) {
      if (err.name !== 'AbortError') {
        this.rogerSay("Error accessing folder.", 0, true);
      }
    }
  }

  openBrowser() {
    if (!this.isBrowserActive) {
      this.viewerContentArea.innerHTML = '';
      this.isBrowserActive = true;
      this.browserControls.classList.add('active');
      this.createNewTab(this.defaultUrl, true);
      this.rogerSay("Browser launched. Surf the vibes!", 5);
    }
  }

  exitBrowserMode() {
    if (!this.isBrowserActive) return;
    this.isBrowserActive = false;
    this.browserControls.classList.remove('active');
    this.tabs = [];
    this.activeTabId = null;
    this.renderTabs();
    this.viewerContentArea.innerHTML = '';
    this.viewerContentArea.appendChild(this.viewerPlaceholder);
  }

  createNewTab(url = this.defaultUrl, makeActive = true) {
    const tabId = `tab-${Date.now()}-${Math.random()}`;
    const iframe = document.createElement('iframe');
    iframe.id = `iframe-${tabId}`;
    iframe.className = 'viewer-content';
    iframe.sandbox = "allow-scripts allow-same-origin allow-forms allow-popups";
    iframe.src = url;

    const tab = { id: tabId, history: [url], currentIndex: 0, title: 'Loading...', iframe };
    
    iframe.onload = () => {
      try { tab.title = iframe.contentDocument.title || this.getDomainFromUrl(iframe.src); } 
      catch (e) { tab.title = this.getDomainFromUrl(iframe.src); }
      this.renderTabs();
    };

    this.tabs.push(tab);
    this.viewerContentArea.appendChild(iframe);
    
    if (makeActive || this.tabs.length === 1) this.switchTab(tabId);
    else this.renderTabs();
    this.rogerSay("New tab opened. Ready to explore!", 3);
  }

  switchTab(tabId) {
    if (this.activeTabId === tabId) return;
    this.activeTabId = tabId;
    this.tabs.forEach(tab => tab.iframe.classList.toggle('active', tab.id === tabId));
    this.updateBrowserUI();
    this.renderTabs();
    this.rogerSay("Switched tabs. Keep the vibe flowing!", 2);
  }

  closeTab(tabId) {
    const tabIndex = this.tabs.findIndex(t => t.id === tabId);
    if (tabIndex === -1) return;
    const [removedTab] = this.tabs.splice(tabIndex, 1);
    removedTab.iframe.remove();
    if (this.tabs.length === 0) {
      this.exitBrowserMode();
      return;
    }
    if (this.activeTabId === tabId) {
      this.switchTab(this.tabs[Math.max(0, tabIndex - 1)].id);
    }
    this.renderTabs();
    this.rogerSay("Tab closed. Vibe streamlined.", 2);
  }

  renderTabs() {
    this.tabsContainer.innerHTML = this.tabs.map(tab => `
      <div class="tab-item ${tab.id === this.activeTabId ? 'active' : ''}" data-tab-id="${tab.id}">
        <span class="tab-title">${tab.title}</span>
        <button class="tab-close" data-tab-id="${tab.id}">×</button>
      </div>
    `).join('');

    this.tabsContainer.querySelectorAll('.tab-item').forEach(el => {
      el.addEventListener('click', (e) => {
        const id = el.dataset.tabId;
        if(e.target.classList.contains('tab-close')) this.closeTab(id);
        else this.switchTab(id);
      });
    });
  }

  navigateToUrl() {
    let url = this.addressBar.value.trim();
    if (!url || !this.activeTabId) return;
    if (!url.startsWith('http')) url = 'https://' + url;
    const tab = this.tabs.find(t => t.id === this.activeTabId);
    tab.iframe.src = url;
    tab.history = tab.history.slice(0, tab.currentIndex + 1);
    tab.history.push(url);
    tab.currentIndex++;
    this.updateBrowserUI();
    this.rogerSay(`Navigating to ${this.getDomainFromUrl(url)}.`, 3);
  }

  browserBack() {
    const tab = this.tabs.find(t => t.id === this.activeTabId);
    if (tab && tab.currentIndex > 0) {
      tab.currentIndex--;
      tab.iframe.src = tab.history[tab.currentIndex];
      this.updateBrowserUI();
      this.rogerSay("Going back. Rewind the vibe!", 2);
    }
  }

  browserForward() {
    const tab = this.tabs.find(t => t.id === this.activeTabId);
    if (tab && tab.currentIndex < tab.history.length - 1) {
      tab.currentIndex++;
      tab.iframe.src = tab.history[tab.currentIndex];
      this.updateBrowserUI();
      this.rogerSay("Moving forward. Keep the momentum!", 2);
    }
  }

  browserReload() {
    const tab = this.tabs.find(t => t.id === this.activeTabId);
    if (tab) {
      tab.iframe.src = tab.iframe.src;
      this.rogerSay("Reloading. Fresh vibe incoming!", 2);
    }
  }

  browserHome() {
    this.addressBar.value = this.defaultUrl;
    this.navigateToUrl();
    this.rogerSay("Back to home base. Vibe reset!", 2);
  }

  updateBrowserUI() {
    const tab = this.tabs.find(t => t.id === this.activeTabId);
    if (!tab) return;
    this.addressBar.value = tab.history[tab.currentIndex];
    this.backBtn.disabled = tab.currentIndex <= 0;
    this.forwardBtn.disabled = tab.currentIndex >= tab.history.length - 1;
  }

  getDomainFromUrl(url) {
    try { return new URL(url).hostname; } 
    catch(e) { return 'Invalid URL'; }
  }

  setupAudioPlayer() {
    this.backgroundAudio.addEventListener('ended', () => this.nextTrack());
    this.backgroundAudio.addEventListener('timeupdate', () => this.updateAudioProgress());
    this.backgroundAudio.addEventListener('play', () => this.audioPlayPauseBtn.textContent = '⏸️');
    this.backgroundAudio.addEventListener('pause', () => this.audioPlayPauseBtn.textContent = '▶️');
  }

  toggleFullscreen() {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
      this.rogerSay("Fullscreen on. Vibe maximized!", 3);
    } else {
      document.exitFullscreen();
      this.rogerSay("Fullscreen off. Back to chill.", 3);
    }
  }
}

let hubInstance;
function loadMedia(type, src, title) { hubInstance.loadMedia(type, src, title); }
function toggleFullscreen() { hubInstance.toggleFullscreen(); }

document.addEventListener('DOMContentLoaded', () => {
  hubInstance = new POPSMediaHub();
});
  </script>
</body>
</html>
