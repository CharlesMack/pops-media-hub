<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>P.O.P.S. Media Hub - Professional Multi-Tab Browser</title>
    <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div id="app">
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon">P</div>
          <div class="logo-text">P.O.P.S. Media Hub</div>
        </div>
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span id="statusText">System Online</span>
        </div>
      </div>
    </header>

    <div class="roger-interface">
      <div class="roger-input-container">
        <div class="roger-avatar">R</div>
        <input id="rogerInput" placeholder="Ask Roger... try 'load folder' or 'playlist'" />
        <button class="roger-mic" onclick="hubInstance.startVoiceCommand()" title="Voice Command">
          <span class="mic-icon">üéôÔ∏è</span>
        </button>
        <button class="roger-send" onclick="hubInstance.processRogerCommand()">Send</button>
      </div>
      <div id="rogerResponse">
        <span id="rogerResponseText"></span>
        <button class="roger-share" onclick="hubInstance.shareRogerResponse()" title="Share to X">üì§</button>
      </div>
      <div class="roger-suggestions" id="rogerSuggestions"></div>
    </div>

    <div class="main-content">
      <div class="sidebar" id="sidebar">
        <button class="sidebar-toggle" id="sidebarToggle" title="Toggle Sidebar">‚óÄ</button>
        
        <!-- Leaderboard Section -->
        <div class="sidebar-section">
          <div class="leaderboard-section">
            <div class="media-panel" onclick="loadMedia('video', 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4', 'üé¨ Big Buck Bunny')">
              <span class="media-panel-icon">üé¨</span>
              <div class="media-panel-title">Movies</div>
              <div class="media-panel-desc">HD Collection</div>
            </div>
            <div class="media-panel" onclick="hubInstance.playBackgroundMusic('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3', 'üéµ Sample Track')">
              <span class="media-panel-icon">üéµ</span>
              <div class="media-panel-title">Music</div>
              <div class="media-panel-desc">Playlist Ready</div>
            </div>
            <div class="media-panel" onclick="loadMedia('image', 'https://picsum.photos/1200/800?random=1', 'üñºÔ∏è Random Art')">
              <span class="media-panel-icon">üñºÔ∏è</span>
              <div class="media-panel-title">Photos</div>
              <div class="media-panel-desc">Gallery View</div>
            </div>
            <div class="media-panel" onclick="hubInstance.openBrowser()">
              <span class="media-panel-icon">üåê</span>
              <div class="media-panel-title">Web Browser</div>
              <div class="media-panel-desc">Multi-Tab</div>
            </div>
          </div>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-title">Quick Actions</div>
          <div class="quick-actions">
            <div class="quick-action" onclick="hubInstance.loadMusicFolder()">
              <span>üìÇ</span> <span>Load Folder</span>
            </div>
            <div class="quick-action" onclick="document.getElementById('filePicker').click()">
              <span>‚ûï</span> <span>Load Files</span>
            </div>
            <div class="quick-action" onclick="hubInstance.showPlaylist()">
              <span>üé∂</span> <span>Show Playlist</span>
            </div>
            <div class="quick-action" onclick="toggleFullscreen()">
              <span>‚õ∂</span> <span>Toggle Fullscreen</span>
            </div>
            <div class="quick-action" onclick="hubInstance.toggleRogerMood()">
              <span>üòé</span> <span>Toggle Roger Mood</span>
            </div>
          </div>
        </div>
      </div>

      <div class="viewer" id="viewer">
        <div class="browser-controls" id="browserControls">
          <div class="browser-nav-top">
            <button class="nav-btn" id="backBtn" onclick="hubInstance.browserBack()" disabled title="Back">‚Üê</button>
            <button class="nav-btn" id="forwardBtn" onclick="hubInstance.browserForward()" disabled title="Forward">‚Üí</button>
            <button class="nav-btn" onclick="hubInstance.browserReload()" title="Reload">‚Üª</button>
            <button class="nav-btn" onclick="hubInstance.browserHome()" title="Home">üè†</button>
            <input 
              type="text" 
              class="address-bar" 
              id="addressBar" 
              placeholder="Enter website URL..."
              onkeydown="if(event.key==='Enter') hubInstance.navigateToUrl()"
            />
          </div>
        </div>
        
        <div class="tabs-container-wrapper">
          <div class="tabs-container" id="tabsContainer"></div>
          <button class="new-tab-btn" id="newTabBtn" title="New Tab (Ctrl+T)">+</button>
        </div>

        <div class="viewer-content-area" id="viewerContentArea">
          <div class="viewer-placeholder" id="viewerPlaceholder">
            <div class="viewer-placeholder-icon">üöÄ</div>
            <div class="viewer-placeholder-text">Ready for Launch</div>
            <div class="viewer-placeholder-desc">Select media or ask Roger to get started</div>
          </div>
        </div>

        <div class="floating-controls" id="floatingControls"></div>
      </div>
    </div>

    <div class="audio-overlay" id="audioOverlay">
      <div class="audio-player-header">
        <div class="audio-player-title">
          <span>üéµ</span>
          <span>Now Playing</span>
        </div>
        <button class="audio-close-btn" onclick="hubInstance.closeAudioPlayer()" title="Close Player">√ó</button>
      </div>
      <div class="audio-controls">
        <button class="audio-btn" onclick="hubInstance.previousTrack()" title="Previous">‚èÆÔ∏è</button>
        <button class="audio-btn play-pause" onclick="hubInstance.toggleAudioPlayback()" id="audioPlayPauseBtn" title="Play/Pause">‚ñ∂Ô∏è</button>
        <button class="audio-btn" onclick="hubInstance.nextTrack()" title="Next">‚è≠Ô∏è</button>
        <div class="audio-info">
          <div class="audio-track-title" id="audioTrackTitle">No track loaded</div>
          <div class="audio-time" id="audioTime">00:00 / 00:00</div>
        </div>
      </div>
      <div class="audio-progress" onclick="hubInstance.seekAudio(event)">
        <div class="audio-progress-bar" id="audioProgressBar"></div>
      </div>
    </div>

    <div class="drop-zone" id="dropZone">
      <div class="drop-zone-content">
        <div>üìÅ Drop files to load</div>
      </div>
    </div>
    
    <div class="playlist-modal-backdrop" id="playlistModalBackdrop">
      <div class="playlist-modal">
        <div class="playlist-header">
          <div class="playlist-title">Music Playlist</div>
          <button class="playlist-close-btn" id="playlistCloseBtn">√ó</button>
        </div>
        <div class="playlist-content" id="playlistContent"></div>
      </div>
    </div>
  </div>

  <input type="file" id="filePicker" accept="audio/*,video/*,image/*" style="display:none" multiple />
  
  <script>
class POPSMediaHub {
  constructor() {
    this.viewerContentArea = document.getElementById('viewerContentArea');
    this.viewerPlaceholder = document.getElementById('viewerPlaceholder');
    this.rogerInput = document.getElementById('rogerInput');
    this.rogerResponse = document.getElementById('rogerResponseText');
    this.rogerSuggestions = document.getElementById('rogerSuggestions');
    this.filePicker = document.getElementById('filePicker');
    this.dropZone = document.getElementById('dropZone');
    this.sidebar = document.getElementById('sidebar');
    this.sidebarToggle = document.getElementById('sidebarToggle');
    this.browserControls = document.getElementById('browserControls');
    this.addressBar = document.getElementById('addressBar');
    this.backBtn = document.getElementById('backBtn');
    this.forwardBtn = document.getElementById('forwardBtn');
    this.tabsContainer = document.getElementById('tabsContainer');
    this.newTabBtn = document.getElementById('newTabBtn');
    this.audioOverlay = document.getElementById('audioOverlay');
    this.backgroundAudio = new Audio();
    this.audioTrackTitle = document.getElementById('audioTrackTitle');
    this.audioTime = document.getElementById('audioTime');
    this.audioProgressBar = document.getElementById('audioProgressBar');
    this.dripPointsDisplay = document.getElementById('dripPoints');
    this.audioPlayPauseBtn = document.getElementById('audioPlayPauseBtn');
    this.playlistModalBackdrop = document.getElementById('playlistModalBackdrop');
    this.playlistContent = document.getElementById('playlistContent');
    this.playlistCloseBtn = document.getElementById('playlistCloseBtn');
    this.isOnline = navigator.onLine;
    this.tabs = [];
    this.activeTabId = null;
    this.isBrowserActive = false;
    this.defaultUrl = 'https://www.google.com/search?q=welcome+to+POPS+media+hub';
    this.leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [{ name: '@mackcwm', points: 0 }];
    this.playlist = [];
    this.currentTrackIndex = -1;
    this.rogerMood = localStorage.getItem('rogerMood') || 'MackGPT';
    this.dripPoints = parseInt(localStorage.getItem('dripPoints')) || 0;
    this.grokAPIKey = null; // Placeholder for xAI Grok API key
    this.mockGrokData = { playlists: [{ title: 'Neon Vibe Mix', src: 'https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3' }], art: [{ title: 'Neon Akron Glow', src: 'https://picsum.photos/1200/800?random=1' }] }; // Mock data
    this.init();
  }

  init() {
    this.setupEventListeners();
    this.initRoger();
    this.setupDragDrop();
    this.updateLeaderboard();
    this.setupAudioPlayer();
    this.rogerSay("Welcome to P.O.P.S. Media Hub! Say 'generate playlist' or 'go chaotic' and share with #POPSvibe to climb the Drip leaderboard. Vibe master, let's roll!", 5);
  }

  setupEventListeners() {
    this.rogerInput.addEventListener('keydown', (e) => e.key === 'Enter' && this.processRogerCommand());
    this.rogerInput.addEventListener('input', () => this.showSuggestions());
    this.filePicker.addEventListener('change', (e) => this.handleFileLoad(e.target.files));
    this.sidebarToggle.addEventListener('click', () => this.toggleSidebar());
    this.newTabBtn.addEventListener('click', () => this.createNewTab());
    this.playlistCloseBtn.addEventListener('click', () => this.hidePlaylist());

    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key.toLowerCase()) {
          case 'o': e.preventDefault(); this.filePicker.click(); break;
          case 'f': e.preventDefault(); this.toggleFullscreen(); break;
          case 't': if (this.isBrowserActive) { e.preventDefault(); this.createNewTab(); } break;
          case 'w': if (this.isBrowserActive && this.activeTabId) { e.preventDefault(); this.closeTab(this.activeTabId); } break;
        }
      }
    });

    // Mobile sidebar handling
    if (window.innerWidth <= 768) {
      this.sidebar.addEventListener('click', (e) => e.stopPropagation());
      document.addEventListener('click', (e) => {
        if (this.sidebar.classList.contains('show') && !this.sidebar.contains(e.target) && !this.sidebarToggle.contains(e.target)) {
          this.sidebar.classList.remove('show');
        }
      });
    }
  }

  setupDragDrop() {
    let dragCounter = 0;
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      document.addEventListener(eventName, e => {
        e.preventDefault();
        e.stopPropagation();
      });
    });
    document.addEventListener('dragenter', () => { dragCounter++; this.dropZone.classList.add('active'); });
    document.addEventListener('dragleave', () => { dragCounter--; if (dragCounter === 0) this.dropZone.classList.remove('active'); });
    document.addEventListener('drop', e => {
      dragCounter = 0;
      this.dropZone.classList.remove('active');
      this.handleFileLoad(e.dataTransfer.files);
    });
  }

  initRoger() {
    this.rogerCommands = {
      'play music': () => this.playBackgroundMusic('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3', 'Roger\'s Choice'),
      'browse web': () => this.openBrowser(),
      'new tab': () => this.isBrowserActive ? this.createNewTab() : this.rogerSay("Open browser first.", 0, true),
      'close tab': () => this.isBrowserActive ? this.closeTab(this.activeTabId) : this.rogerSay("No active tab.", 0, true),
      'clear': () => this.clearViewer(),
      'fullscreen': () => this.toggleFullscreen(),
      'collapse sidebar': () => this.toggleSidebar(true),
      'expand sidebar': () => this.toggleSidebar(false),
      'playlist': () => this.showPlaylist(),
      'load folder': () => this.loadMusicFolder(),
      'toggle mood': () => this.toggleRogerMood(),
      'go chaotic': () => {
        this.rogerMood = 'LackGPT';
        localStorage.setItem('rogerMood', 'LackGPT');
        this.rogerSay("Chaos mode activated. Let's get weird.", 5);
      },
      'ask grok': async () => {
        if (!this.grokAPIKey) {
          this.rogerSay("Grok API not configured yet. Stay tuned for the collab vibe!", 0, true);
          return;
        }
        // Simulate Grok API call for demo
        this.rogerSay("Grok API vibes incoming! Dropped a neon art piece.", 5);
        this.loadMedia('image', this.mockGrokData.art[0].src, this.mockGrokData.art[0].title);
      },
      'generate playlist': async () => {
        if (!this.grokAPIKey) {
          this.rogerSay("Grok API not ready yet. Try loading a folder for now!", 0, true);
          return;
        }
        // Simulate Grok API playlist generation
        this.rogerSay(`Generated ${this.rogerMood}-inspired playlist! Vibe on.`, 5);
        this.addToPlaylist(this.mockGrokData.playlists[0]);
        if (this.currentTrackIndex === -1) {
          this.playTrack(this.playlist.length - 1);
        }
      }
    };
    this.moodResponses = {
      MackGPT: {
        default: "Yo, you're crushing it! Let's drop that vibe! üöÄ",
        error: "Whoa, vibe check failed! Try a new command, champ."
      },
      LackGPT: {
        default: "Pfft, you call that a command? Let's see something with more chaos.",
        error: "Yawn, that didn't work. Try not to bore me next time."
      },
      GuideGPT: {
        default: "All set! What do you want to explore next?",
        error: "Hmm, that command didn't work. Try 'play music' or 'new tab'."
      }
    };
  }

  toggleSidebar(forceState = null) {
    const isMobile = window.innerWidth <= 768;
    
    if (isMobile) {
      this.sidebar.classList.toggle('show');
      this.rogerSay(this.sidebar.classList.contains('show') ? "Sidebar opened." : "Sidebar closed.", 2);
    } else {
      const isCollapsed = forceState !== null ? forceState : this.sidebar.classList.contains('collapsed');
      this.sidebar.classList.toggle('collapsed', !isCollapsed);
      this.sidebarToggle.classList.toggle('collapsed', !isCollapsed);
      this.rogerSay(isCollapsed ? "Sidebar expanded. Vibe wide open!" : "Sidebar collapsed. Streamlined flow.", 2);
    }
  }

  processRogerCommand() {
    const input = this.rogerInput.value.toLowerCase().trim();
    if (!input) return;
    this.rogerInput.value = '';
    this.rogerSuggestions.classList.remove('active');

    let found = false;
    for (const [command, action] of Object.entries(this.rogerCommands)) {
      if (input.includes(command)) {
        action();
        this.addDripPoints(2); // Award Drip for command use
        found = true;
        break;
      }
    }
    if (!found) this.rogerSay(`Command "${input}" not recognized.`, 0, true);
  }

  rogerSay(message, dripPoints = 0, isError = false) {
    const responseKey = isError ? 'error' : 'default';
    const prefix = this.moodResponses[this.rogerMood][responseKey];
    this.rogerResponse.textContent = `Roger: ${prefix} ${message}${dripPoints > 0 ? ` (+${dripPoints} Drip)` : ''}`;
    this.rogerResponse.parentElement.classList.add('active');
    setTimeout(() => this.rogerResponse.parentElement.classList.remove('active'), 5000);
    if (dripPoints > 0) this.addDripPoints(dripPoints);
  }

  startVoiceCommand() {
    if (!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) {
      this.rogerSay("Voice commands not supported. Type it out, vibe master!", 0, true);
      return;
    }
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    const rogerMic = document.querySelector('.roger-mic');
    rogerMic.classList.add('active');

    recognition.onresult = (e) => {
      const command = e.results[0][0].transcript.toLowerCase();
      this.rogerInput.value = command;
      this.processRogerCommand();
      rogerMic.classList.remove('active');
      this.addDripPoints(3); // Extra Drip for voice command
    };
    recognition.onerror = (e) => {
      this.rogerSay(`Voice error: ${e.error}. Try typing your vibe.`, 0, true);
      rogerMic.classList.remove('active');
    };
    recognition.onend = () => rogerMic.classList.remove('active');
    recognition.start();
    this.rogerSay("Listening for your vibe...");
  }

  showSuggestions() {
    const input = this.rogerInput.value.toLowerCase().trim();
    if (input.length < 2) {
      this.rogerSuggestions.classList.remove('active');
      return;
    }
    const suggestions = Object.keys(this.rogerCommands).filter(cmd => cmd.includes(input));
    this.rogerSuggestions.innerHTML = suggestions.length
      ? suggestions.map(cmd => `<div class="suggestion-item" onclick="hubInstance.rogerInput.value='${cmd}';hubInstance.processRogerCommand()">${cmd}</div>`).join('')
      : '<div class="suggestion-item">No matching commands</div>';
    this.rogerSuggestions.classList.add('active');
  }

  toggleRogerMood() {
    const moods = ['MackGPT', 'LackGPT', 'GuideGPT'];
    this.rogerMood = moods[(moods.indexOf(this.rogerMood) + 1) % moods.length];
    localStorage.setItem('rogerMood', this.rogerMood);
    this.rogerSay(`Switched to ${this.rogerMood} mode. Let's vibe!`, 5);
  }

  shareRogerResponse() {
    const response = this.rogerResponse.textContent;
    const shareText = encodeURIComponent(`${response} #POPSvibe`);
    window.open(`https://x.com/intent/tweet?text=${shareText}`, '_blank');
    this.rogerSay("Shared your vibe to X! Keep it üíØ.", 10);
    this.addDripPoints(10); // Drip for sharing
  }

  addToPlaylist(track) {
    if (!this.playlist.some(t => t.src === track.src)) {
      this.playlist.push(track);
    }
  }

  playTrack(index) {
    if (index < 0 || index >= this.playlist.length) return;
    this.currentTrackIndex = index;
    const track = this.playlist[index];
    this.backgroundAudio.src = track.src;
    this.audioTrackTitle.textContent = track.title;
    this.backgroundAudio.play().catch(e => this.rogerSay("Playback requires user interaction.", 0, true));
    this.audioOverlay.classList.add('active');
    if(this.playlistModalBackdrop.classList.contains('active')) this.renderPlaylist();
    this.rogerSay(`Playing ${track.title}.`, 3);
  }

  playBackgroundMusic(src, title) {
    this.addToPlaylist({src, title});
    this.playTrack(this.playlist.length - 1);
  }

  toggleAudioPlayback() {
    if (this.backgroundAudio.paused) {
      this.backgroundAudio.play();
      this.rogerSay("Track playing. Vibe on!", 2);
    } else {
      this.backgroundAudio.pause();
      this.rogerSay("Track paused. Chill mode.", 2);
    }
  }

  nextTrack() {
    this.playTrack((this.currentTrackIndex + 1) % this.playlist.length);
  }

  previousTrack() {
    this.playTrack((this.currentTrackIndex - 1 + this.playlist.length) % this.playlist.length);
  }

  closeAudioPlayer() {
    this.backgroundAudio.pause();
    this.backgroundAudio.src = '';
    this.audioOverlay.classList.remove('active');
    this.currentTrackIndex = -1;
    this.rogerSay("Audio player closed. Silence is a vibe too.", 2);
  }

  updateAudioProgress() {
    const { currentTime, duration } = this.backgroundAudio;
    if (duration) {
      this.audioProgressBar.style.width = `${(currentTime / duration) * 100}%`;
      this.audioTime.textContent = `${this.formatTime(currentTime)} / ${this.formatTime(duration)}`;
    }
  }

  seekAudio(event) {
    const { offsetWidth } = event.currentTarget;
    this.backgroundAudio.currentTime = (event.offsetX / offsetWidth) * this.backgroundAudio.duration;
    this.rogerSay("Scrubbed to new vibe!", 2);
  }

  showPlaylist() {
    this.renderPlaylist();
    this.playlistModalBackdrop.classList.add('active');
    this.rogerSay("Playlist open. Pick your vibe!", 3);
  }

  hidePlaylist() {
    this.playlistModalBackdrop.classList.remove('active');
    this.rogerSay("Playlist closed. Keep the vibes flowing.", 2);
  }

  renderPlaylist() {
    if (this.playlist.length === 0) {
      this.playlistContent.innerHTML = '<p style="text-align: center; color: var(--text-muted);">Playlist is empty. Load some music!</p>';
      return;
    }
    this.playlistContent.innerHTML = this.playlist.map((track, index) => `
      <div class="playlist-item ${index === this.currentTrackIndex ? 'playing' : ''}" data-index="${index}">
        <span>${index === this.currentTrackIndex ? '‚ñ∂' : 'üéµ'}</span>
        <span class="playlist-item-title">${track.title}</span>
        <div class="playlist-item-controls">
          <button data-action="up" data-index="${index}" ${index === 0 ? 'disabled' : ''}>‚Üë</button>
          <button data-action="down" data-index="${index}" ${index === this.playlist.length - 1 ? 'disabled' : ''}>‚Üì</button>
          <button data-action="remove" data-index="${index}">√ó</button>
        </div>
      </div>
    `).join('');
    
    this.playlistContent.querySelectorAll('.playlist-item').forEach(el => {
      el.addEventListener('click', e => {
        const index = parseInt(el.dataset.index);
        const action = e.target.dataset.action;
        if (action === 'up') {
          this.moveTrack(index, -1);
          this.rogerSay("Track moved up. Vibe reordered!", 2);
        } else if (action === 'down') {
          this.moveTrack(index, 1);
          this.rogerSay("Track moved down. Vibe reordered!", 2);
        } else if (action === 'remove') {
          this.removeTrack(index);
          this.rogerSay("Track removed. Playlist streamlined.", 2);
        } else {
          this.playTrack(index);
        }
      });
    });
  }

  moveTrack(index, direction) {
    if (direction === -1 && index === 0) return;
    if (direction === 1 && index === this.playlist.length - 1) return;
    const newIndex = index + direction;
    [this.playlist[index], this.playlist[newIndex]] = [this.playlist[newIndex], this.playlist[index]];
    if(this.currentTrackIndex === index) this.currentTrackIndex = newIndex;
    else if(this.currentTrackIndex === newIndex) this.currentTrackIndex = index;
    this.renderPlaylist();
  }

  removeTrack(index) {
    this.playlist.splice(index, 1);
    if(this.currentTrackIndex === index) {
      this.playTrack(index % this.playlist.length);
    } else if (this.currentTrackIndex > index) {
      this.currentTrackIndex--;
    }
    this.renderPlaylist();
  }

  formatTime(s) { return new Date(s * 1000).toISOString().substr(14, 5); }

  toggleFullscreen() {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
      this.rogerSay("Fullscreen on. Vibe maximized!", 3);
    } else {
      document.exitFullscreen();
      this.rogerSay("Fullscreen off. Back to chill.", 3);
    }
  }
}

let hubInstance;
function loadMedia(type, src, title) { hubInstance.loadMedia(type, src, title); }
function toggleFullscreen() { hubInstance.toggleFullscreen(); }

document.addEventListener('DOMContentLoaded', () => {
  hubInstance = new POPSMediaHub();
});
  </script>
</body>
</html>dDripPoints(points) {
    this.dripPoints += points;
    localStorage.setItem('dripPoints', this.dripPoints);
    this.updateLeaderboard();
  }

  updateLeaderboard() {
    this.dripPointsDisplay.textContent = this.dripPoints;
    this.leaderboard[0].points = this.dripPoints; // Mock: update @mackcwm's score
    localStorage.setItem('leaderboard', JSON.stringify(this.leaderboard));
    const leaderboardList = document.getElementById('leaderboardList');
    leaderboardList.innerHTML = this.leaderboard
      .sort((a, b) => b.points - a.points)
      .slice(0, 5)
      .map((item, index) => `<div class="leaderboard-item">${index === 0 ? 'üëë ' : ''}${item.name} - ${item.points} Drip</div>`)
      .join('');
  }

  loadMedia(type, src, title = 'Media') {
    this.exitBrowserMode();
    this.viewerContentArea.innerHTML = '';
    let element;
    switch(type) {
      case 'video': element = document.createElement('video'); element.controls = true; break;
      case 'image': element = document.createElement('img'); break;
    }
    element.src = src;
    element.className = 'viewer-content';
    this.viewerContentArea.appendChild(element);
    this.rogerSay(`Now displaying: ${title}`, 2);
  }

  clearViewer() {
    this.exitBrowserMode();
    this.viewerContentArea.innerHTML = '';
    this.viewerContentArea.appendChild(this.viewerPlaceholder);
    this.rogerSay("Viewer cleared.", 2);
  }

  handleFileLoad(files) {
    if (!files || files.length === 0) return;
    let audioFilesFound = 0;
    for(const file of files) {
      const url = URL.createObjectURL(file);
      if (file.type.startsWith('audio/')) {
        this.addToPlaylist({ src: url, title: `üìÅ ${file.name}` });
        audioFilesFound++;
      }
    }
    if (audioFilesFound > 0 && this.currentTrackIndex === -1) {
      this.playTrack(0);
    }
    this.rogerSay(`${files.length} file(s) processed. ${audioFilesFound} audio track(s) added to playlist.`, audioFilesFound * 2);
  }

  async loadMusicFolder() {
    if (!window.showDirectoryPicker) {
      this.rogerSay("Folder access is not supported by your browser.", 0, true);
      return;
    }
    try {
      const dirHandle = await window.showDirectoryPicker();
      let count = 0;
      for await (const entry of dirHandle.values()) {
        if (entry.kind === 'file') {
          const file = await entry.getFile();
          if (file.type.startsWith('audio/')) {
            const url = URL.createObjectURL(file);
            this.addToPlaylist({ src: url, title: `üìÅ ${file.name}` });
            count++;
          }
        }
      }
      if (count > 0 && this.currentTrackIndex === -1) {
        this.playTrack(0);
      }
      this.rogerSay(`Loaded ${count} tracks from the folder.`, count * 2);
    } catch (err) {
      if (err.name !== 'AbortError') {
        this.rogerSay("Error accessing folder.", 0, true);
      }
    }
  }

  openBrowser() {
    if (!this.isBrowserActive) {
      this.viewerContentArea.innerHTML = '';
      this.isBrowserActive = true;
      this.browserControls.classList.add('active');
      this.createNewTab(this.defaultUrl, true);
      this.rogerSay("Browser launched. Surf the vibes!", 5);
    }
  }

  exitBrowserMode() {
    if (!this.isBrowserActive) return;
    this.isBrowserActive = false;
    this.browserControls.classList.remove('active');
    this.tabs = [];
    this.activeTabId = null;
    this.renderTabs();
    this.viewerContentArea.innerHTML = '';
    this.viewerContentArea.appendChild(this.viewerPlaceholder);
  }

  createNewTab(url = this.defaultUrl, makeActive = true) {
    const tabId = `tab-${Date.now()}-${Math.random()}`;
    const iframe = document.createElement('iframe');
    iframe.id = `iframe-${tabId}`;
    iframe.className = 'viewer-content';
    iframe.sandbox = "allow-scripts allow-same-origin allow-forms allow-popups";
    iframe.src = url;

    const tab = { id: tabId, history: [url], currentIndex: 0, title: 'Loading...', iframe };
    
    iframe.onload = () => {
      try { tab.title = iframe.contentDocument.title || this.getDomainFromUrl(iframe.src); } 
      catch (e) { tab.title = this.getDomainFromUrl(iframe.src); }
      this.renderTabs();
    };

    this.tabs.push(tab);
    this.viewerContentArea.appendChild(iframe);
    
    if (makeActive || this.tabs.length === 1) this.switchTab(tabId);
    else this.renderTabs();
    this.rogerSay("New tab opened. Ready to explore!", 3);
  }

  switchTab(tabId) {
    if (this.activeTabId === tabId) return;
    this.activeTabId = tabId;
    this.tabs.forEach(tab => tab.iframe.classList.toggle('active', tab.id === tabId));
    this.updateBrowserUI();
    this.renderTabs();
    this.rogerSay("Switched tabs. Keep the vibe flowing!", 2);
  }

  closeTab(tabId) {
    const tabIndex = this.tabs.findIndex(t => t.id === tabId);
    if (tabIndex === -1) return;
    const [removedTab] = this.tabs.splice(tabIndex, 1);
    removedTab.iframe.remove();
    if (this.tabs.length === 0) {
      this.exitBrowserMode();
      return;
    }
    if (this.activeTabId === tabId) {
      this.switchTab(this.tabs[Math.max(0, tabIndex - 1)].id);
    }
    this.renderTabs();
    this.rogerSay("Tab closed. Vibe streamlined.", 2);
  }

  renderTabs() {
    this.tabsContainer.innerHTML = this.tabs.map(tab => `
      <div class="tab-item ${tab.id === this.activeTabId ? 'active' : ''}" data-tab-id="${tab.id}">
        <span class="tab-title">${tab.title}</span>
        <button class="tab-close" data-tab-id="${tab.id}">√ó</button>
      </div>
    `).join('');

    this.tabsContainer.querySelectorAll('.tab-item').forEach(el => {
      el.addEventListener('click', (e) => {
        const id = el.dataset.tabId;
        if(e.target.classList.contains('tab-close')) this.closeTab(id);
        else this.switchTab(id);
      });
    });
  }

  navigateToUrl() {
    let url = this.addressBar.value.trim();
    if (!url || !this.activeTabId) return;
    if (!url.startsWith('http')) url = 'https://' + url;
    const tab = this.tabs.find(t => t.id === this.activeTabId);
    tab.iframe.src = url;
    tab.history = tab.history.slice(0, tab.currentIndex + 1);
    tab.history.push(url);
    tab.currentIndex++;
    this.updateBrowserUI();
    this.rogerSay(`Navigating to ${this.getDomainFromUrl(url)}.`, 3);
  }

  browserBack() {
    const tab = this.tabs.find(t => t.id === this.activeTabId);
    if (tab && tab.currentIndex > 0) {
      tab.currentIndex--;
      tab.iframe.src = tab.history[tab.currentIndex];
      this.updateBrowserUI();
      this.rogerSay("Going back. Rewind the vibe!", 2);
    }
  }

  browserForward() {
    const tab = this.tabs.find(t => t.id === this.activeTabId);
    if (tab && tab.currentIndex < tab.history.length - 1) {
      tab.currentIndex++;
      tab.iframe.src = tab.history[tab.currentIndex];
      this.updateBrowserUI();
      this.rogerSay("Moving forward. Keep the momentum!", 2);
    }
  }

  browserReload() {
    const tab = this.tabs.find(t => t.id === this.activeTabId);
    if (tab) {
      tab.iframe.src = tab.iframe.src;
      this.rogerSay("Reloading. Fresh vibe incoming!", 2);
    }
  }

  browserHome() {
    this.addressBar.value = this.defaultUrl;
    this.navigateToUrl();
    this.rogerSay("Back to home base. Vibe reset!", 2);
  }

  updateBrowserUI() {
    const tab = this.tabs.find(t => t.id === this.activeTabId);
    if (!tab) return;
    this.addressBar.value = tab.history[tab.currentIndex];
    this.backBtn.disabled = tab.currentIndex <= 0;
    this.forwardBtn.disabled = tab.currentIndex >= tab.history.length - 1;
  }

  getDomainFromUrl(url) {
    try { return new URL(url).hostname; } 
    catch(e) { return 'Invalid URL'; }
  }

  setupAudioPlayer() {
    this.backgroundAudio.addEventListener('ended', () => this.nextTrack());
    this.backgroundAudio.addEventListener('timeupdate', () => this.updateAudioProgress());
    this.backgroundAudio.addEventListener('play', () => this.audioPlayPauseBtn.textContent = '‚è∏Ô∏è');
    this.backgroundAudio.addEventListener('pause', () => this.audioPlayPauseBtn.textContent = '‚ñ∂Ô∏è');
  }

  ad="leaderboard-header">
              <div class="sidebar-title">üèÜ Drip Leaderboard</div>
              <div class="drip-counter">
                <span>üíé</span>
                <span id="dripPoints">0</span>
                <span>Drip</span>
              </div>
            </div>
            <div class="leaderboard-list" id="leaderboardList">
              <div class="leaderboard-item">@mackcwm - 0 Drip</div>
            </div>
          </div>
        </div>

        <div class="sidebar-section">
          <div class="sidebar-title">Media Library</div>
          <div class="media-grid">
            <div class
